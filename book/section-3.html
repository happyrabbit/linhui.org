<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>数据科学家：R语言</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.0.60 and GitBook 2.6.7">

  <meta property="og:title" content="数据科学家：R语言" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

<meta name="author" content="Hui Lin">

<meta name="date" content="2016-04-02">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="section-2.html">
<link rel="next" href="section-4.html">

<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数据科学家：R语言</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 介绍</a></li>
<li class="chapter" data-level="2" data-path="section-2.html"><a href="section-2.html"><i class="fa fa-check"></i><b>2</b> 数据科学</a><ul>
<li class="chapter" data-level="2.1" data-path="section-2.html"><a href="section-2.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 什么是数据科学？</a></li>
<li class="chapter" data-level="2.2" data-path="section-2.html"><a href="section-2.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 什么是数据科学家？</a></li>
<li class="chapter" data-level="2.3" data-path="section-2.html"><a href="section-2.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 数据科学家需要的技能</a></li>
<li class="chapter" data-level="2.4" data-path="section-2.html"><a href="section-2.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 数据科学可以解决什么问题？</a><ul>
<li class="chapter" data-level="2.4.1" data-path="section-2.html"><a href="section-2.html#section-2.4.1"><i class="fa fa-check"></i><b>2.4.1</b> 前提要求</a></li>
<li class="chapter" data-level="2.4.2" data-path="section-2.html"><a href="section-2.html#section-2.4.2"><i class="fa fa-check"></i><b>2.4.2</b> 问题种类</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-3.html"><a href="section-3.html"><i class="fa fa-check"></i><b>3</b> 数据分析一般流程</a><ul>
<li class="chapter" data-level="3.1" data-path="section-3.html"><a href="section-3.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 模拟服装消费者数据</a></li>
<li class="chapter" data-level="3.2" data-path="section-3.html"><a href="section-3.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 问题到数据</a></li>
<li class="chapter" data-level="3.3" data-path="section-3.html"><a href="section-3.html#section-3.3"><i class="fa fa-check"></i><b>3.3</b> 数据到信息</a></li>
<li class="chapter" data-level="3.4" data-path="section-3.html"><a href="section-3.html#section-3.4"><i class="fa fa-check"></i><b>3.4</b> 信息到行动</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 数据预处理</a><ul>
<li class="chapter" data-level="4.1" data-path="section-4.html"><a href="section-4.html#-1"><i class="fa fa-check"></i><b>4.1</b> 介绍</a></li>
<li class="chapter" data-level="4.2" data-path="section-4.html"><a href="section-4.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 数据清理</a></li>
<li class="chapter" data-level="4.3" data-path="section-4.html"><a href="section-4.html#section-4.3"><i class="fa fa-check"></i><b>4.3</b> 缺失值填补</a><ul>
<li class="chapter" data-level="4.3.1" data-path="section-4.html"><a href="section-4.html#section-4.3.1"><i class="fa fa-check"></i><b>4.3.1</b> 中位数或众数填补</a></li>
<li class="chapter" data-level="4.3.2" data-path="section-4.html"><a href="section-4.html#k-"><i class="fa fa-check"></i><b>4.3.2</b> K-近邻填补</a></li>
<li class="chapter" data-level="4.3.3" data-path="section-4.html"><a href="section-4.html#section-4.3.3"><i class="fa fa-check"></i><b>4.3.3</b> 袋状树填补</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="section-4.html"><a href="section-4.html#section-4.4"><i class="fa fa-check"></i><b>4.4</b> 中心化和标量化</a></li>
<li class="chapter" data-level="4.5" data-path="section-4.html"><a href="section-4.html#section-4.5"><i class="fa fa-check"></i><b>4.5</b> 有偏分布</a></li>
<li class="chapter" data-level="4.6" data-path="section-4.html"><a href="section-4.html#section-4.6"><i class="fa fa-check"></i><b>4.6</b> 处理离群点</a></li>
<li class="chapter" data-level="4.7" data-path="section-4.html"><a href="section-4.html#section-4.7"><i class="fa fa-check"></i><b>4.7</b> 共线性</a></li>
<li class="chapter" data-level="4.8" data-path="section-4.html"><a href="section-4.html#section-4.8"><i class="fa fa-check"></i><b>4.8</b> 稀疏变量</a></li>
<li class="chapter" data-level="4.9" data-path="section-4.html"><a href="section-4.html#section-4.9"><i class="fa fa-check"></i><b>4.9</b> 编码名义变量</a></li>
<li class="chapter" data-level="4.10" data-path="section-4.html"><a href="section-4.html#section-4.10"><i class="fa fa-check"></i><b>4.10</b> 数据整合和整形</a><ul>
<li class="chapter" data-level="4.10.1" data-path="section-4.html"><a href="section-4.html#apply"><i class="fa fa-check"></i><b>4.10.1</b> apply()函数</a></li>
<li class="chapter" data-level="4.10.2" data-path="section-4.html"><a href="section-4.html#ddply"><i class="fa fa-check"></i><b>4.10.2</b> ddply()函数</a></li>
<li class="chapter" data-level="4.10.3" data-path="section-4.html"><a href="section-4.html#section-4.10.3"><i class="fa fa-check"></i><b>4.10.3</b> 数据整形</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="section-4.html"><a href="section-4.html#section-4.11"><i class="fa fa-check"></i><b>4.11</b> 本章总结</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-5.html"><a href="section-5.html"><i class="fa fa-check"></i><b>5</b> 建模技术简介</a><ul>
<li class="chapter" data-level="5.1" data-path="section-5.html"><a href="section-5.html#section-5.1"><i class="fa fa-check"></i><b>5.1</b> 数据划分和再抽样</a><ul>
<li class="chapter" data-level="5.1.1" data-path="section-5.html"><a href="section-5.html#section-5.1.1"><i class="fa fa-check"></i><b>5.1.1</b> 划分训练集和测试集</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="section-5.html"><a href="section-5.html#a-random-sample-of-5-data-points"><i class="fa fa-check"></i><b>5.2</b> A random sample of 5 data points</a></li>
<li class="chapter" data-level="5.3" data-path="section-5.html"><a href="section-5.html#section-5.3"><i class="fa fa-check"></i><b>5.3</b> 模型选择</a><ul>
<li class="chapter" data-level="5.3.1" data-path="section-5.html"><a href="section-5.html#section-5.3.1"><i class="fa fa-check"></i><b>5.3.1</b> 回归模型表现度量</a></li>
<li class="chapter" data-level="5.3.2" data-path="section-5.html"><a href="section-5.html#section-5.3.2"><i class="fa fa-check"></i><b>5.3.2</b> 分类模型表现度量</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="section-5.html"><a href="section-5.html#section-5.4"><i class="fa fa-check"></i><b>5.4</b> 建模需要注意的问题</a><ul>
<li class="chapter" data-level="5.4.1" data-path="section-5.html"><a href="section-5.html#section-5.4.1"><i class="fa fa-check"></i><b>5.4.1</b> 因变量误差</a></li>
<li class="chapter" data-level="5.4.2" data-path="section-5.html"><a href="section-5.html#section-5.4.2"><i class="fa fa-check"></i><b>5.4.2</b> 自变量误差</a></li>
<li class="chapter" data-level="5.4.3" data-path="section-5.html"><a href="section-5.html#section-5.4.3"><i class="fa fa-check"></i><b>5.4.3</b> 失衡数据</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-6.html"><a href="section-6.html"><i class="fa fa-check"></i><b>6</b> 特征工程</a><ul>
<li class="chapter" data-level="6.1" data-path="section-6.html"><a href="section-6.html#section-6.1"><i class="fa fa-check"></i><b>6.1</b> 变量选择</a></li>
<li class="chapter" data-level="6.2" data-path="section-6.html"><a href="section-6.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 主成分分析</a></li>
<li class="chapter" data-level="6.3" data-path="section-6.html"><a href="section-6.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 因子分析</a></li>
<li class="chapter" data-level="6.4" data-path="section-6.html"><a href="section-6.html#section-6.4"><i class="fa fa-check"></i><b>6.4</b> 高维标度化</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-7.html"><a href="section-7.html"><i class="fa fa-check"></i><b>7</b> 线性回归极其衍生</a><ul>
<li class="chapter" data-level="7.1" data-path="section-7.html"><a href="section-7.html#section-7.1"><i class="fa fa-check"></i><b>7.1</b> 普通线性回归</a></li>
<li class="chapter" data-level="7.2" data-path="section-7.html"><a href="section-7.html#section-7.2"><i class="fa fa-check"></i><b>7.2</b> 收缩方法</a></li>
<li class="chapter" data-level="7.3" data-path="section-7.html"><a href="section-7.html#section-7.3"><i class="fa fa-check"></i><b>7.3</b> 分层线性回归</a></li>
<li class="chapter" data-level="7.4" data-path="section-7.html"><a href="section-7.html#section-7.4"><i class="fa fa-check"></i><b>7.4</b> 贝叶斯线性回归</a></li>
<li class="chapter" data-level="7.5" data-path="section-7.html"><a href="section-7.html#section-7.5"><i class="fa fa-check"></i><b>7.5</b> 贝叶斯分层线性回归</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-8.html"><a href="section-8.html"><i class="fa fa-check"></i><b>8</b> 树模型</a><ul>
<li class="chapter" data-level="8.1" data-path="section-8.html"><a href="section-8.html#section-8.1"><i class="fa fa-check"></i><b>8.1</b> 基本树模型</a></li>
<li class="chapter" data-level="8.2" data-path="section-8.html"><a href="section-8.html#section-8.2"><i class="fa fa-check"></i><b>8.2</b> 装袋树</a></li>
<li class="chapter" data-level="8.3" data-path="section-8.html"><a href="section-8.html#section-8.3"><i class="fa fa-check"></i><b>8.3</b> 随机森林</a></li>
<li class="chapter" data-level="8.4" data-path="section-8.html"><a href="section-8.html#section-8.4"><i class="fa fa-check"></i><b>8.4</b> 其它树话题</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-9.html"><a href="section-9.html"><i class="fa fa-check"></i><b>9</b> 聚类判别分析</a><ul>
<li class="chapter" data-level="9.1" data-path="section-9.html"><a href="section-9.html#section-9.1"><i class="fa fa-check"></i><b>9.1</b> 聚类分析</a></li>
<li class="chapter" data-level="9.2" data-path="section-9.html"><a href="section-9.html#section-9.2"><i class="fa fa-check"></i><b>9.2</b> 判别分析</a><ul>
<li class="chapter" data-level="9.2.1" data-path="section-9.html"><a href="section-9.html#section-9.2.1"><i class="fa fa-check"></i><b>9.2.1</b> 逻辑回归</a></li>
<li class="chapter" data-level="9.2.2" data-path="section-9.html"><a href="section-9.html#section-9.2.2"><i class="fa fa-check"></i><b>9.2.2</b> 线性判别分析</a></li>
<li class="chapter" data-level="9.2.3" data-path="section-9.html"><a href="section-9.html#section-9.2.3"><i class="fa fa-check"></i><b>9.2.3</b> 最小二乘判别分析</a></li>
<li class="chapter" data-level="9.2.4" data-path="section-9.html"><a href="section-9.html#section-9.2.4"><i class="fa fa-check"></i><b>9.2.4</b> 朴素贝叶斯</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="section-9.html"><a href="section-9.html#section-9.3"><i class="fa fa-check"></i><b>9.3</b> 案例：客户分组</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-10.html"><a href="section-10.html"><i class="fa fa-check"></i><b>10</b> 关联法则分析</a><ul>
<li class="chapter" data-level="10.1" data-path="section-10.html"><a href="section-10.html#section-10.1"><i class="fa fa-check"></i><b>10.1</b> 关联法则简介</a></li>
<li class="chapter" data-level="10.2" data-path="section-10.html"><a href="section-10.html#section-10.2"><i class="fa fa-check"></i><b>10.2</b> 案例：商业购物篮分析</a></li>
<li class="chapter" data-level="10.3" data-path="section-10.html"><a href="section-10.html#section-10.3"><i class="fa fa-check"></i><b>10.3</b> 关联法则可视化</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-11.html"><a href="section-11.html"><i class="fa fa-check"></i><b>11</b> 数据可视化和结果展示</a><ul>
<li class="chapter" data-level="11.1" data-path="section-11.html"><a href="section-11.html#r-markdown"><i class="fa fa-check"></i><b>11.1</b> R Markdown</a><ul>
<li class="chapter" data-level="11.1.1" data-path="section-11.html"><a href="section-11.html#what-is-r-markdown"><i class="fa fa-check"></i><b>11.1.1</b> What is R Markdown?</a></li>
<li class="chapter" data-level="11.1.2" data-path="section-11.html"><a href="section-11.html#how-to-start"><i class="fa fa-check"></i><b>11.1.2</b> How to Start?</a></li>
<li class="chapter" data-level="11.1.3" data-path="section-11.html"><a href="section-11.html#interactive-r-markdown-document"><i class="fa fa-check"></i><b>11.1.3</b> Interactive R Markdown Document</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-12.html"><a href="section-12.html"><i class="fa fa-check"></i><b>12</b> 数据科学的科学</a></li>
<li class="chapter" data-level="13" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>13</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数据科学家：R语言</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-3" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> 数据分析一般流程</h1>
<p>数据科学的目的是找到数据背后潜藏的模式，这个模式就是我们所说的信息。仅仅挖掘出信息是不够的，你还要利用信息作出具体的行动，最终将信息转化成知识，然后从知识到行动从而创造价值。这个数据分析流程将数据分析的技术部分放在了一个更大的应用语境下，重点从技术建模到根据发现采取行动，这章我们要重点讨论得到可实践的数据分析结果。当前有太多介绍分析技术的书籍对数据分析定义很狭隘，好像只要将当前最华丽的模型（如神经网络，随机森林，支持向量机）通过某种统计软件套用在数据上，得到结果报告就结束了。这些方法模型都是很重要的，但是分析的过程可不仅仅是一系列功能强大的模型和结构完整的数据。我们要在恰当的应用领域，将正确的方法用在合适的数据上。整个数据分析的流程是个迭代学习的过程，每一步都在前一步的结果之上更深入的理解（挖掘）数据。积累的经验反馈又可用于优化整个过程。因此这是一个自反馈的生态环。该流程具体是怎样的呢？“数据分析的一般流程”图展示了这个生态环的6个阶段，图中每一个步骤旁边方括号内的百分比是该步骤大致占用的时间范围。整个分析成功的关键在于将数据分析嵌入实际问题的语境中，最终分析师能够将数据中提取的信息通过交流传达给客户，指导推动用户付出行动创造价值。下面我会逐一对每个阶段进行讲解。但在此之前，我们先模拟一个关于某品牌服装消费者的数据，本章会用该数据为例展示数据分析的流程，该数据及也会在之后的章节中反复用到。</p>
<div class="figure">
<img src="/Users/happyrabbit/Dropbox/Book_DS/Figure/GernalProcess.png" />
</div>
<div id="section-3.1" class="section level2">
<h2><span class="header-section-number">3.1</span> 模拟服装消费者数据</h2>
<p>我们先模拟一个关于某品牌服装消费者的数据，这个数据会在之后的章节中反复用到。数据中包含N=1000个观测，我们将模拟3类变量（括号内是变量对应的模拟数据框中的列标签名）：</p>
<p>（1）人口统计学变量。</p>
<ul>
<li>年龄（age）</li>
<li>性别（gender）</li>
<li>有房还是租房（house）</li>
</ul>
<p>（2）消费者行为变量。</p>
<ul>
<li>2015年实体店购买该品牌服装花销（store_exp）</li>
<li>2015年在线购买该品牌服装花销（online_exp）</li>
<li>2015年实体店交易次数（store_trans）</li>
<li>2015年在线交易次数（online_trans）</li>
</ul>
<p>（3）客户认知问卷调查。为了进一步了解消费者，商家时常对消费者进行问卷调查，然后对调查结果进行分组，其目标是寻找在产品兴趣，市场参与度或营销反应的重要方面有显著差异的客户群。通过了解组间的不同，市场营销人员可以优化产品定位，进行更加精准的营销。这里我们假设该服装品牌对消费者进行了下面的调查，并模拟该调查问卷的回复。</p>
<p>你是否同意下面的申明？</p>
<table>
<thead>
<tr class="header">
<th align="left">问题</th>
<th align="left">1（非常不同意）</th>
<th align="left">2（有点不同意）</th>
<th align="left">3（中立/不知道）</th>
<th align="left">4（有点同意）</th>
<th align="left">5（非常同意）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">（Q1）：我喜欢买不同品牌的服装，比较它们</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q2）：我喜欢买同一个品牌的服装</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q3）：品牌的知名度对我来说非常重要</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q4）：服装质量对我来说非常重要</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q5）：服装风格我喜欢的风格</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q6）：我喜欢在实体店购买</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q7）：我喜欢在网上购买</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q8）：价格对我来说很重要</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q9）：我喜欢不同风格的衣服</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q10）：我喜欢自己挑选服装，不需要周围人的建议</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>我们进一步假设这些根据问卷调查的结果可以将消费者分成4组：价格敏感（Price），炫耀性消费（Conspicuous），质量（Quality），风格（Style）。 （本章我们不会提到如何得到这些分组；我们假设这些已知。我们会在第9章中介绍聚类分析时会更详细的说明。）</p>
<p>你也可以重复下面的代码，自己创建该数据。我们强烈建议读者重复数据模拟的过程，这样能加深对模型方法的理解。如果你对此不感兴趣，也可以从本书网站上直接下载数据：</p>
<pre class="sourceCode r"><code class="sourceCode r">sim.dat&lt;-<span class="kw">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/happyrabbit/DataScientistR/master/Data/SegData.csv&quot;</span>)</code></pre>
<p>获得该数据集后你可以跳过本小节后半部分直接跳到下一节对分析流程的讲解。否则，继续本节。</p>
<p>模拟该数据的过程有些复杂，我们先模拟描述客户的变量。模拟该数据的代码分为3部分：</p>
<ol style="list-style-type: decimal">
<li>定义数据结构：定义变量名，变量类型，消费者分组名，各组大小。</li>
<li>变量分布参数，如各自的均值和方差。</li>
<li>在各组和各个变量上迭代，基于定义和参数设置抽取随机数。</li>
</ol>
<p>通过这种方式组织代码，如果我们要改变部分模拟方式重新抽取数据就比较容易。例如，如果我们想要加一个组，或者改变其中某个人口统计变量的均值，只要稍微改变代码就好。我们也想通过这个结构介绍新的R代码，生成数据的第3个步骤中将用到这些代码。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 设置随机种子，使数据模拟过程可重复</span>
<span class="kw">set.seed</span>(<span class="dv">12345</span>)
<span class="co"># 定义观测数目</span>
ncust&lt;-<span class="dv">1000</span>
<span class="co"># 建立数据框存放模拟观测，初始数据框中只有一列id，即消费者编号</span>
seg_dat&lt;-<span class="kw">data.frame</span>(<span class="dt">id=</span><span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="dv">1</span>:ncust)))
<span class="co"># 指定要生成的变量，并为变量命名</span>
vars&lt;-<span class="kw">c</span>(<span class="st">&quot;age&quot;</span>,<span class="st">&quot;gender&quot;</span>,<span class="st">&quot;income&quot;</span>,<span class="st">&quot;house&quot;</span>,<span class="st">&quot;store_exp&quot;</span>,<span class="st">&quot;online_exp&quot;</span>,<span class="st">&quot;store_trans&quot;</span>,<span class="st">&quot;online_trans&quot;</span>)
<span class="co"># 每个变量对应的数据类型</span>
<span class="co"># norm： 正态分布</span>
<span class="co"># binom: 二项分布</span>
<span class="co"># pois： 泊松分布</span>
vartype&lt;-<span class="kw">c</span>(<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;binom&quot;</span>,<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;binom&quot;</span>,<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;pois&quot;</span>,<span class="st">&quot;pois&quot;</span>)
<span class="co"># 四个消费者分组的名称</span>
group_name&lt;-<span class="kw">c</span>(<span class="st">&quot;Price&quot;</span>,<span class="st">&quot;Conspicuous&quot;</span>,<span class="st">&quot;Quality&quot;</span>,<span class="st">&quot;Style&quot;</span>)
<span class="co"># 各消费者群组的大小</span>
group_size&lt;-<span class="kw">c</span>(<span class="dv">250</span>,<span class="dv">200</span>,<span class="dv">200</span>,<span class="dv">350</span>)
<span class="co"># group_name和group_size的第一个元素表明，对于“Price”这组消费者，我们将模拟N=250个观测。</span></code></pre>
<p>定义好了数据的基本结构之后，我们下一步是定义分布参数，用这些参数来抽取相应数据。 这里我们要 模拟的数据有4个样本类，8个非抽样调查变量，因此我们创建一个4×8的均值矩阵，因为不同类别的 消费者对应不同的分布参数。下面代码用来创建均值矩阵：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 定义均值矩阵</span>
mus &lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(
  <span class="co"># 价格敏感（Price）类对应均值</span>
  <span class="dv">60</span>, <span class="fl">0.5</span>, <span class="dv">120000</span>,<span class="fl">0.9</span>, <span class="dv">500</span>,<span class="dv">200</span>,<span class="dv">5</span>,<span class="dv">2</span>,
  <span class="co"># 炫耀性消费（Conspicuous）类对应均值</span>
  <span class="dv">40</span>, <span class="fl">0.7</span>, <span class="dv">200000</span>,<span class="fl">0.9</span>, <span class="dv">5000</span>,<span class="dv">5000</span>,<span class="dv">10</span>,<span class="dv">10</span>,
  <span class="co"># 质量（Quality）类对应均值</span>
  <span class="dv">36</span>, <span class="fl">0.5</span>, <span class="dv">70000</span>, <span class="fl">0.4</span>, <span class="dv">300</span>, <span class="dv">2000</span>,<span class="dv">2</span>,<span class="dv">15</span>,
  <span class="co"># 风格（Style）类对应均值</span>
  <span class="dv">25</span>, <span class="fl">0.2</span>, <span class="dv">90000</span>, <span class="fl">0.2</span>, <span class="dv">200</span>, <span class="dv">2000</span>,<span class="dv">2</span>,<span class="dv">20</span>), <span class="dt">ncol=</span><span class="kw">length</span>(vars), <span class="dt">byrow=</span><span class="ot">TRUE</span>)</code></pre>
<p>具体过程是怎样的？ 均值矩阵<code>mus</code>指定，例如，价格敏感（Price）类群体的第一个变量（这里是年龄age）均值为60，炫耀性消费（Conspicuous）类群体的年龄均值为40依次类推。正态分布变量需要指定均值和方差，如年龄（<code>age</code>）， 实体店花销（<code>store_exp</code>）和在线花销（<code>online_exp</code>）。对于二项分布（只有两个可能取值）和泊松分布变量，我们只需要规定均值。其中，性别（<code>gender</code>），有房还是租房（<code>house</code>）是二项数据，生成这样的数据需要指定得到其中某一观测值的概率，比如矩阵<code>mus</code>中。实体店交易次数（<code>store_trans</code>）和线交易次数（<code>online_trans</code>）是泊松变量（频数），泊松分布只有一个参数——分布均值。所以在下面的标准差矩阵<code>sds</code>中，非正态分布变量对应的标准差为缺失值<code>NA</code>。（注意这里我们只是用这些分布为例生成数据，并不意味着这些是最好的拟合变量观测的分布。例如，真实的收入数据更可能是一个有偏的分布而非正态）。</p>
<p>下面我们对正态分布变量创建标准差矩阵：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 每类的标准差 (NA = 标准差无定义)</span>
sds&lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(
  <span class="co"># 价格敏感（Price）类对应均值</span>
  <span class="dv">3</span>,<span class="ot">NA</span>,<span class="dv">8000</span>,<span class="ot">NA</span>,<span class="dv">100</span>,<span class="dv">50</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,
  <span class="co"># 炫耀性消费（Conspicuous）类对应均值</span>
  <span class="dv">5</span>,<span class="ot">NA</span>,<span class="dv">50000</span>,<span class="ot">NA</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,
  <span class="co"># 质量（Quality）类对应均值</span>
  <span class="dv">7</span>,<span class="ot">NA</span>,<span class="dv">10000</span>,<span class="ot">NA</span>,<span class="dv">50</span>,<span class="dv">200</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,
  <span class="co"># 风格（Style）类对应均值</span>
  <span class="dv">2</span>,<span class="ot">NA</span>,<span class="dv">5000</span>,<span class="ot">NA</span>,<span class="dv">10</span>,<span class="dv">500</span>,<span class="ot">NA</span>,<span class="ot">NA</span>), <span class="dt">ncol=</span><span class="kw">length</span>(vars), <span class="dt">byrow=</span><span class="ot">TRUE</span>)</code></pre>
<p>将这两个矩阵加在一起我们就能够完全定义各个类的分布了。例如，我们来看下每个矩阵的第1行，其代表第1类群体（价格敏感）的分布参数。这些值规定该类群体的年龄（age）均值为60（见第一个矩阵第1行第1列），标准差为3（第二个矩阵第1行第1列）。另外，其中大约有50%的男性（第一个矩阵第1行第2列），年收入（income）均值为120000元，标准差为8000元。将这些设置分开存在不同表格中，将来想要修改十分容易。将数据定义和抽样过程分开是个很好的习惯。下面开始抽取数据：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 抽取非抽样调查数据</span>
sim.dat&lt;-<span class="ot">NULL</span>
<span class="kw">set.seed</span>(<span class="dv">2016</span>)
<span class="co"># 对消费者类别进行循环（i）</span>
 for (i in <span class="kw">seq_along</span>(group_name)){
   <span class="co"># 为了核实代码，展示循环运行过程，我们在循环中添加了这样一行代码</span>
   <span class="co"># 函数运行时会打印出正在抽取的样本类名</span>
   <span class="kw">cat</span> (i, group_name[i],<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="co"># 创建一个空矩阵用于存放该类消费者相关数据</span>
  seg&lt;-<span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>group_size[i], <span class="dt">ncol=</span><span class="kw">length</span>(vars)))  
  <span class="co"># 在这个类之内，对不同变量迭代，抽取相应的随机数据</span>
  for (j in <span class="kw">seq_along</span>(vars)){
    <span class="co"># 在每个变量上迭代</span>
    if (vartype[j]==<span class="st">&quot;norm&quot;</span>){
      <span class="co"># 抽取正态分布变量</span>
      seg[,j]&lt;-<span class="kw">rnorm</span>(group_size[i], <span class="dt">mean=</span>mus[i,j], <span class="dt">sd=</span>sds[i,j])
    } else if (vartype[j]==<span class="st">&quot;pois&quot;</span>) {
      <span class="co"># 抽取泊松分布变量</span>
      seg[,j]&lt;-<span class="kw">rpois</span>(group_size[i], <span class="dt">lambda=</span>mus[i,j])
    } else if (vartype[j]==<span class="st">&quot;binom&quot;</span>){
      <span class="co"># 抽取二项分布变量</span>
      seg[,j]&lt;-<span class="kw">rbinom</span>(group_size[i],<span class="dt">size=</span><span class="dv">1</span>,<span class="dt">prob=</span>mus[i,j])
    } else{
      <span class="co"># 如果变量类型不是上述几种，程序停止运行并提示信息</span>
      <span class="kw">stop</span> (<span class="st">&quot;Don&#39;t have type:&quot;</span>,vartype[j])
    }        
  }
  <span class="co"># 将该消费者类的数据依行添加到总数据集</span>
  sim.dat&lt;-<span class="kw">rbind</span>(sim.dat,seg)
 }</code></pre>
<pre><code>## 1 Price 
## 2 Conspicuous 
## 3 Quality 
## 4 Style</code></pre>
<p>上面的代码是随机抽样的主要过程，其中<code>cat()</code>函数使得循环运行时会打印出正在抽取的样本类名，最后得到的<code>sim.dat</code>是初始描述客户的变量部分的数据，在对数据进行润色前，提醒大家注意两个关于R的技巧：</p>
<p>第一、在i循环内，我们事先定义一个有着相应行数和列数的没有元素值的数据框<code>seg</code>，之后每迭代一次就将样本赋值到事先定义的<code>seg</code>的特定行。这么做的原因是由于只要R在某个对象上添加东西——如在数据框上增加一行——它都会将原对象拷贝一份。这将使用两倍的内存，减慢运行速度。通过这种方法可以避免对内存的浪费。对这里的小数据可能感觉不出差别，但对于大数据，运行速度会有极大不同。</p>
<p>第二、对循环指针范围的设定用的是<code>seq_along()</code>而非<code>1:length()</code>。这是为了够避免一些常见的错误，如指针向量长度为0或者不经意将向量方向弄反了。</p>
<p>之后我们对描述客户的这部分数据进行完善，添加合适的列标签，将二项（0/1）变量转化为贴有标签的因子变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 指定数据框的列名为我们定义的变量名</span>
<span class="kw">names</span>(sim.dat)&lt;-vars
<span class="co"># 加上一个因子列表明每个观测的对应的消费者类别</span>
sim.dat$segment&lt;-<span class="kw">factor</span>(<span class="kw">rep</span>(group_name,<span class="dt">times=</span>group_size))
<span class="co"># 将二项变量转化为贴有标签的因子变量</span>
<span class="co"># Female: 女性</span>
<span class="co"># Male: 男性</span>
sim.dat$gender&lt;-<span class="kw">factor</span>(sim.dat$gender, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Male&quot;</span>))
sim.dat$house&lt;-<span class="kw">factor</span>(sim.dat$house, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))
<span class="co"># 假设在线购买和在实体店购买的次数至少为1，所以这里在原随机值上加1</span>
sim.dat$store_trans&lt;-sim.dat$store_trans<span class="dv">+1</span>
sim.dat$online_trans&lt;-sim.dat$online_trans<span class="dv">+1</span>
<span class="co"># 年龄为整数</span>
sim.dat$age&lt;-<span class="kw">floor</span>(sim.dat$age)</code></pre>
<p>真实市场营销数据往往没有这么干净，数据缺失，以及错误输入等问题常常发生。我们最后对模拟的数据做一点“破坏”，使其更像真实的数据。我们假设一些人不愿意给出关于收入（<code>income</code>）的信息。我们建立一个逻辑变量<code>idxm</code>，然后将逻辑变量<code>idxm</code>值为真的对应位置消费者收入观测设为缺失值<code>NA</code>（R用<code>NA</code>表示缺失值）。我们假设年龄（age）越大的消费者对应缺失值的概率越大：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 加入缺失值</span>
idxm &lt;-<span class="st"> </span><span class="kw">as.logical</span>(<span class="kw">rbinom</span>(ncust, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span>sim.dat$age/<span class="dv">200</span>))
sim.dat$income[idxm]&lt;-<span class="ot">NA</span></code></pre>
<p>真实的数据中可能有错误的输入，或者离群点：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 错误输入，离群点</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)
idx&lt;-<span class="kw">sample</span>(<span class="dv">1</span>:ncust,<span class="dv">5</span>)
sim.dat$age[idx[<span class="dv">1</span>]]&lt;-<span class="dv">300</span>
sim.dat$store_exp[idx[<span class="dv">2</span>]]&lt;-<span class="st"> </span>-<span class="dv">500</span>
sim.dat$store_exp[idx[<span class="dv">3</span>:<span class="dv">5</span>]]&lt;-<span class="kw">c</span>(<span class="dv">50000</span>,<span class="dv">30000</span>,<span class="dv">30000</span>)</code></pre>
<p>到目前为止我们已经建立了一部分数据，你可以通过<code>summary(sim.dat)</code>检查数据。下面我们接着抽取问卷调查回复数据。我们先通过<code>rnorm()</code>生成正态分布随机数。但从上面的问卷调查表格中可以看到，这是一个1-5分量级的问卷，1代表非常不同意，5代表非常同意。于是接下来我们通过<code>floor()</code>函数将连续值转化成离散整数。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 抽取问卷调查回复</span>
<span class="co"># 问卷问题数目</span>
nq&lt;-<span class="dv">10</span>
<span class="co"># 各类消费者对问卷回复的正态分布均值矩阵</span>
mus2 &lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(
  <span class="co"># 价格敏感（Price）类对应均值</span>
 <span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,
  <span class="co"># 炫耀性消费（Conspicuous）类对应均值</span>
 <span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>,
  <span class="co"># 质量（Quality）类对应均值</span>
 <span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,
  <span class="co"># 风格（Style）类对应均值</span>
 <span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>), <span class="dt">ncol=</span>nq, <span class="dt">byrow=</span><span class="ot">TRUE</span>)

<span class="co"># 方差假设都是0.2</span>
sd2&lt;-<span class="fl">0.2</span>
sim.dat2&lt;-<span class="ot">NULL</span>
<span class="kw">set.seed</span>(<span class="dv">1000</span>)
<span class="co"># 对消费者类别进行循环（i）</span>
for (i in <span class="kw">seq_along</span>(group_name)){
  <span class="co"># 为了核实代码，展示循环运行过程，我们在循环中添加了这样一行代码</span>
  <span class="co"># 函数运行时会打印出正在抽取的样本类名，这里不再显示输出</span>
  <span class="co"># cat (i, group_name[i],&quot;\n&quot;)</span>
  <span class="co"># 创建一个空矩阵用于存放该类消费者相关数据</span>
  seg&lt;-<span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>group_size[i], <span class="dt">ncol=</span>nq))  
  <span class="co"># 在这个类之内，对不同变量迭代，抽取相应的随机数据</span>
  for (j in <span class="dv">1</span>:nq){
    <span class="co"># 抽取正态分布变量</span>
    res&lt;-<span class="kw">rnorm</span>(group_size[i], <span class="dt">mean=</span>mus2[i,j], <span class="dt">sd=</span>sd2)
    <span class="co"># 设置上下限度</span>
    res[res&gt;<span class="dv">5</span>]&lt;-<span class="dv">5</span>
    res[res&lt;<span class="dv">1</span>]&lt;-<span class="dv">1</span>
    <span class="co"># 通过 floor()函数将连续值转化成离散整数。</span>
    seg[,j]&lt;-<span class="kw">floor</span>(res)
  }
  <span class="co"># 将该消费者类的数据添加到总数据集</span>
  sim.dat2&lt;-<span class="kw">rbind</span>(sim.dat2,seg)
}

<span class="co"># 为数据框添加列标签</span>
<span class="kw">names</span>(sim.dat2)&lt;-<span class="kw">paste</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span>:<span class="dv">10</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
<span class="co"># 合并两部分数据</span>
sim.dat&lt;-<span class="kw">cbind</span>(sim.dat,sim.dat2)
<span class="co"># 加上一个因子列表明每个观测的对应的消费者类别</span>
sim.dat$segment&lt;-<span class="kw">factor</span>(<span class="kw">rep</span>(group_name,<span class="dt">times=</span>group_size))</code></pre>
<p>至此为止我们得到了需要的数据集。让我们检查一下抽取的数据集：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(sim.dat,<span class="dt">vec.len=</span><span class="dv">3</span>)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  19 variables:
##  $ age         : num  57 63 59 60 51 59 57 57 ...
##  $ gender      : Factor w/ 2 levels &quot;Female&quot;,&quot;Male&quot;: 1 1 2 2 2 2 2 2 ...
##  $ income      : num  120963 122008 114202 113616 ...
##  $ house       : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 ...
##  $ store_exp   : num  529 478 491 348 ...
##  $ online_exp  : num  304 110 279 142 ...
##  $ store_trans : num  2 4 7 10 4 4 5 11 ...
##  $ online_trans: num  2 2 2 2 4 5 3 5 ...
##  $ segment     : Factor w/ 4 levels &quot;Conspicuous&quot;,..: 2 2 2 2 2 2 2 2 ...
##  $ Q1          : num  4 4 5 5 4 4 4 5 ...
##  $ Q2          : num  2 1 2 2 1 2 1 2 ...
##  $ Q3          : num  1 1 1 1 1 1 1 1 ...
##  $ Q4          : num  2 2 2 3 3 2 2 3 ...
##  $ Q5          : num  1 1 1 1 1 1 1 1 ...
##  $ Q6          : num  4 4 4 4 4 3 3 3 ...
##  $ Q7          : num  1 1 1 1 1 1 1 1 ...
##  $ Q8          : num  4 3 3 4 4 3 3 4 ...
##  $ Q9          : num  2 1 1 2 2 1 1 2 ...
##  $ Q10         : num  4 4 3 3 4 3 4 3 ...</code></pre>
<p>可以看到，服装消费者数据有1000个观测，19个变量。前8个变量是关于样本的人口统计学和购买行为描述。Q1-Q10是关于消费者选择偏好的问卷调查回复，问卷分值量表为1-5分（最常见的市场调查设计）。最后一列是消费者类别，样本观测的模拟是根据消费者类别进行的，因此这些可以当作“真实”的消费者类别。使用随机模拟的一个重要优点就是能够通过这种方式验证模型的效果。而实际生活中的数据样本真正所属类别通常是未知的。我们在之后对聚类和判别分析进行介绍的时候会使用样本类别信息。下面我们会反复用该数据集为例。</p>
</div>
<div id="section-3.2" class="section level2">
<h2><span class="header-section-number">3.2</span> 问题到数据</h2>
<p>分析的流程开始于一个具体的问题，一定确保准确理解客户的问题。这里所说的“客户”是广义上的，如果你是在专门的统计咨询公司工作，那客户可以是其它需要统计分析帮助的组织机构，如果你在企业内部从事相关分析工作，那客户可以是你所支持的部门的同事，如产品经理，市场总监，科研部门化学、生物领域的科学家等等。分析的新手很容易犯的一个错误就是在没有确保准确理解客户问题的情况下就开始收集分析数据，最后白忙一场，对于各方都造成时间上的损失。如何避免这样的情况发生？交流！通过交流，将问题尽可能具体化。这个在之前讲到过，你的问题需要尽可能具体到：</p>
<ol style="list-style-type: decimal">
<li>知道问题的类别：是比较，描述，聚类，判别还是回归</li>
<li>知道需要什么样的数据：我们有哪些数据，数据的质量如何，还需要收集哪些数据，哪些是自变量，哪些是应变量。</li>
</ol>
<p>以上面服装消费者为例。假设某服装公司的营销人员找到你，希望知道该如何通过更精准的营销提高效率。该服装公司旗下有多个品牌。这是一个非常泛的商业问题，遇到这样的问题你下一步该怎么办？对，将问题具体化。在我看来，问题的关键在于清晰的定义客户所谓的精准具体指哪方面？是针对某一品牌的线上广告希望能准确锁定消费者的注意力？还是某个特定款式的服装打算打折，想要知道谁最可能对这个打折信息感兴趣？或是不同品牌有不同价位，不同款式，他们想知道关于这些不同类型的服装的产品信息的目标客户群是什么？可能之前他们没有对客户进行区分，广告信息对所有客户都是相同的，现在他们希望更加精确的对不同类型的客户提供不同的服装信息，如可以在用户浏览网页时对不同客户显示不同的服装推荐，可以在不同的杂志刊登不同的广告（不同杂志可能对应不同的读者群），或者对系统内客户发送不同的邮件促销广告。</p>
<p>假设通过进一步交流知道客户感兴趣的是最后一个问题：跨品牌的精准营销。那么接下来我会继续问客户下面的问题：</p>
<ol style="list-style-type: decimal">
<li>你们都有什么品牌？这些品牌的价位都是怎样的？风格质量如何？</li>
<li>你们有哪些关于消费者的数据？（人口统计学数据，在线消费，实体店消费）</li>
<li>是不是还有其它关于消费者选择偏好的数据？</li>
</ol>
<p>反复交流过后，我们或许可以得到类似模拟的服装消费者数据，其中包括1000个消费者的人口统计学数据，1年内的在线/实体店消费量，在线购/实体店购买次数，以及关于选择偏好的问卷调查数据。此外，我们可以将该问题定义为聚类问题。在你阅读了全书之后，遇到这种情况可能脑子里已经有一些候选模型了。你还需要和客户协商制定一个结果交付的计划，什么时候交付结果，结果是书面报告还是需要一个演讲展示，在项目进行的过程中是不是需要设定几个时间点双方交流讨论进展情况，有什么新数据，或客户有什么需要补充的，这些和数据分析不直接相关，但对于一个合格的数据科学家而言，项目管理能力同样不可缺少。至此，在这个例子中我们完成从问题到数据这一步骤了。关于这一步骤最后强调一点，在和客户交流的过程中，保证交流的重点是客户要解决的问题，而不是你要使用的分析技术和算法。除非客户对你要用的模型方法有兴趣，一般情况下不需要提及具体可能用到的模型。</p>
</div>
<div id="section-3.3" class="section level2">
<h2><span class="header-section-number">3.3</span> 数据到信息</h2>
<p>数据到信息的过程牵扯到流程图中的四步：数据准备，数据清理，建模和模型评估。对于数据准备这里不过多介绍，对于非实验环境（如市场的案例），这一步主要是通过SQL从数据库中读取相应数据，或者有些客户以电子表格的形式给你的数据（如调查问卷回复），你需要将不同来源的数据合并起来。对于实验室环境下，如医药，生物相关实验，数据科学家（更常见的称呼是“统计师”，这些几乎全都是根正苗红的统计学背景的研究人员）或许会涉入收集数据之前的实验设计环节，确保收集到的数据能够用来回答相应的问题。</p>
<p>对于从数据预处理到模型检验这些步骤的具体细节和常用方法我会在之后专门章节更详细的介绍。但这里我想先对数据分析这个过程进行一个大体描述。有几个方面值得深入进行探讨。首先大家可以从图上看到，数据预处理占用相当大比例的时间。预处理技术一般指数据的清理、变换或者缺失值填补，这些我们在下面数据预处理的章节会更详细的介绍。虽然数据预处理不是正式建模，但这一步能够极大的影响模型的精确度（对于预测模型）和可解释性。一个简单的例子是通过回归系数估计比较回归模型中各参数对结果变量的贡献，在这个问题中，需要保证数据中各个变量的尺度一致，我们模拟的服装消费者数据中的变量尺度就不一致：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 选取数据框中的列“age”和“income”，得到子数据框</span>
sdat&lt;-<span class="kw">subset</span>(sim.dat,<span class="dt">select=</span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>,<span class="st">&quot;income&quot;</span>))
<span class="co"># 对子数据框进行总结</span>
<span class="kw">summary</span>(sdat)</code></pre>
<pre><code>##       age             income      
##  Min.   : 16.00   Min.   : 41776  
##  1st Qu.: 25.00   1st Qu.: 85832  
##  Median : 36.00   Median : 93869  
##  Mean   : 38.84   Mean   :113543  
##  3rd Qu.: 53.00   3rd Qu.:124572  
##  Max.   :300.00   Max.   :319704  
##                   NA&#39;s   :184</code></pre>
<p>从上面通过<code>summary()</code>函数的输出可以看到（这里我们只展示其中两个变量，想要检查整个数据框的总结信息，可以键入 <code>summary(sim.dat)</code>），收入（income）的观测尺度明显大于年龄（age）。如果没有数据变换，拟合模型的变量系数之间是没有可比性的。</p>
<p>其次，建立和评估模型通常离不开数据划分（交互校验）在服装消费者数据的例子中，如果研究兴趣在于预测一个新的消费者在未来一年里在这个公司服装上的消费额，这种情况下预测的样本和用来建模的样本属于不同的群体。这意味着，我们不仅需要检查模型对当前数据的拟合程度，还需要评估模型外推至新样本的能力。为了做到这一点，我们需要将样本划分成训练集和测试集。训练集用于拟合模型，测试集用于评估模型在新样本上预测的能力。我们会在之后的建模技术模块进一步介绍划分训练集和测试集的不同方法。</p>
<p>实际应用中的数据有时含有许多变量（多维度），这可能导致一系列问题。如由于自变量之间存在相关性导致模型估计不稳定，如果模型是以预测为目的，则会降低预测准确性。太多变量还会导致模型难以解释，极大削弱其应用价值，尤其在市场营销这样的领域，模型的解释性和其应用价值紧密联系。例如，在服装消费者调查问卷中有10个关于消费者对服装不同方面的在意程度的问题，可能在这些问题的回复背后有几个潜在的概念，如对价格的敏感，炫耀性心理的满足，产品质量和风格，这些概念是潜藏在背后促使消费者对表面上10个问题做出回复的因子。如果我们能将这样的问卷调查观测降至少数潜在因子的维度，便可更清晰的识别人们在哪些因子上存在不同，进而更有针对性的进行品牌营销。因为这个话题在实际应用中非常重要，我们会用专门一个章节（特征工程）进行讲解。</p>
<p>关于这部分流程还有一个重要的问题是选择合适的模型评估标准。在使用测试集之前，有两种方法可以用来决定模型的效能。首先，可以使用一些模型表现的度量。根据具体数据评估度量可能不同，比如对离散应变量，我们通常使用AUC，每类的错误率来作为评估标准；对于连续应变量，可以使用<span class="math">\(R^2\)</span>，RMSE等方式。另外一个工具是进行简单的模型可视化，如作出观测数据与预测数据的散点图，发掘出模型表现特别好或者特别差的区域。这些定性的信息对改进模型非常关键，如果只是用总结性的统计量去衡量就会失去这些信息。</p>
<p>根据经验，一些建模者会依赖于自己钟爱的某个模型。然而天下没有免费的午餐，关于你要解决的问题信息不足的情况下，没有一个模型总是比其它模型更有效。因此，建模者应该在一个具体问题上尝试各种方法，之后再选择一个特定的模型。</p>
<p>有两种意义上的模型选择。我们可以选择一类模型而放弃另一类，比如因为线性回归模型拟合效果不好，因而用多元自适应回归样条（MARS）。在这种情况下，我们其实是在<strong>模型之间</strong>进行选择。模型选择还有另外一种形式，就是在同类模型中选择。比如在拟合MARS时，我们通过交叉验证选择模型中的调优参数，这也是一种模型选择。这里我们选择的是MARS模型的具体种类，即是在MARS模型这个大类之内进行选择。在两种情形下，我们都依赖于交叉检验，模型评估标准和测试集得到定量的模型评估，从而帮助我们作出选择。</p>
</div>
<div id="section-3.4" class="section level2">
<h2><span class="header-section-number">3.4</span> 信息到行动</h2>
<p>业界普遍反映数据科学家欠缺将数据中的信息转化为商业知识的能力，大部分数据科学家止于从数据到信息这一步。如何做到从信息到知识呢？这个需要你对所在行业有较深入的了解，具有应用该行业说故事的能力。这是艺术的部分。这也是一个矛盾的地方，因为这意味着数据科学家不如很多人之前所设想的可以单独成为一个职能，应用在不同的领域。当从技术角度上说这是可行的，但是从实践的角度，仅是应用技术得到一个模型结果远远不够，将结果转化为真正的市场营销的决策建议并和相关营销人员交流，保证结果应用在市场营销中提高效率，是非常关键的收尾环节，这一步决定了你工作的价值。但这一步要求深入了解行业，做到这点需要在某个特定行业中从业较长时间，因此从实践上讲，一个数据分析师很难细致了解每一个行业，即使“从数据到信息”这个步骤可以一般化到不同领域，但从“信息到知识”将数据科学家从某种程度上限定于某一领域。</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-4.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/index.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>


</body>

</html>
