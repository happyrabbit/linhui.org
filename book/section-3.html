<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>数据科学家：R语言</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.0.60 and GitBook 2.6.7">

  <meta property="og:title" content="数据科学家：R语言" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="林荟">

<meta name="date" content="2016-04-08">

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="section-2.html">
<link rel="next" href="section-4.html">

<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数据科学家：R语言</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 介绍</a></li>
<li class="chapter" data-level="2" data-path="section-2.html"><a href="section-2.html"><i class="fa fa-check"></i><b>2</b> 数据科学</a><ul>
<li class="chapter" data-level="2.1" data-path="section-2.html"><a href="section-2.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 什么是数据科学？</a></li>
<li class="chapter" data-level="2.2" data-path="section-2.html"><a href="section-2.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 什么是数据科学家？</a></li>
<li class="chapter" data-level="2.3" data-path="section-2.html"><a href="section-2.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 数据科学家需要的技能</a></li>
<li class="chapter" data-level="2.4" data-path="section-2.html"><a href="section-2.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 数据科学可以解决什么问题？</a><ul>
<li class="chapter" data-level="2.4.1" data-path="section-2.html"><a href="section-2.html#section-2.4.1"><i class="fa fa-check"></i><b>2.4.1</b> 前提要求</a></li>
<li class="chapter" data-level="2.4.2" data-path="section-2.html"><a href="section-2.html#section-2.4.2"><i class="fa fa-check"></i><b>2.4.2</b> 问题种类</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-3.html"><a href="section-3.html"><i class="fa fa-check"></i><b>3</b> 数据集模拟和背景介绍</a><ul>
<li class="chapter" data-level="3.1" data-path="section-3.html"><a href="section-3.html#section-3.1"><i class="fa fa-check"></i><b>3.1</b> 服装消费者数据</a></li>
<li class="chapter" data-level="3.2" data-path="section-3.html"><a href="section-3.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 航空公司满意度调查</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 数据分析一般流程</a><ul>
<li class="chapter" data-level="4.1" data-path="section-4.html"><a href="section-4.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 问题到数据</a></li>
<li class="chapter" data-level="4.2" data-path="section-4.html"><a href="section-4.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 数据到信息</a></li>
<li class="chapter" data-level="4.3" data-path="section-4.html"><a href="section-4.html#section-4.3"><i class="fa fa-check"></i><b>4.3</b> 信息到行动</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-5.html"><a href="section-5.html"><i class="fa fa-check"></i><b>5</b> 数据预处理</a><ul>
<li class="chapter" data-level="5.1" data-path="section-5.html"><a href="section-5.html#section-5.1"><i class="fa fa-check"></i><b>5.1</b> 介绍</a></li>
<li class="chapter" data-level="5.2" data-path="section-5.html"><a href="section-5.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 数据清理</a></li>
<li class="chapter" data-level="5.3" data-path="section-5.html"><a href="section-5.html#section-5.3"><i class="fa fa-check"></i><b>5.3</b> 缺失值填补</a><ul>
<li class="chapter" data-level="5.3.1" data-path="section-5.html"><a href="section-5.html#section-5.3.1"><i class="fa fa-check"></i><b>5.3.1</b> 中位数或众数填补</a></li>
<li class="chapter" data-level="5.3.2" data-path="section-5.html"><a href="section-5.html#k-"><i class="fa fa-check"></i><b>5.3.2</b> K-近邻填补</a></li>
<li class="chapter" data-level="5.3.3" data-path="section-5.html"><a href="section-5.html#section-5.3.3"><i class="fa fa-check"></i><b>5.3.3</b> 袋状树填补</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="section-5.html"><a href="section-5.html#section-5.4"><i class="fa fa-check"></i><b>5.4</b> 中心化和标量化</a></li>
<li class="chapter" data-level="5.5" data-path="section-5.html"><a href="section-5.html#section-5.5"><i class="fa fa-check"></i><b>5.5</b> 有偏分布</a></li>
<li class="chapter" data-level="5.6" data-path="section-5.html"><a href="section-5.html#section-5.6"><i class="fa fa-check"></i><b>5.6</b> 处理离群点</a></li>
<li class="chapter" data-level="5.7" data-path="section-5.html"><a href="section-5.html#section-5.7"><i class="fa fa-check"></i><b>5.7</b> 共线性</a></li>
<li class="chapter" data-level="5.8" data-path="section-5.html"><a href="section-5.html#section-5.8"><i class="fa fa-check"></i><b>5.8</b> 稀疏变量</a></li>
<li class="chapter" data-level="5.9" data-path="section-5.html"><a href="section-5.html#section-5.9"><i class="fa fa-check"></i><b>5.9</b> 编码名义变量</a></li>
<li class="chapter" data-level="5.10" data-path="section-5.html"><a href="section-5.html#section-5.10"><i class="fa fa-check"></i><b>5.10</b> 数据整合和整形</a><ul>
<li class="chapter" data-level="5.10.1" data-path="section-5.html"><a href="section-5.html#apply"><i class="fa fa-check"></i><b>5.10.1</b> apply()函数</a></li>
<li class="chapter" data-level="5.10.2" data-path="section-5.html"><a href="section-5.html#ddply"><i class="fa fa-check"></i><b>5.10.2</b> ddply()函数</a></li>
<li class="chapter" data-level="5.10.3" data-path="section-5.html"><a href="section-5.html#section-5.10.3"><i class="fa fa-check"></i><b>5.10.3</b> 数据整形</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="section-5.html"><a href="section-5.html#section-5.11"><i class="fa fa-check"></i><b>5.11</b> 本章总结</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-6.html"><a href="section-6.html"><i class="fa fa-check"></i><b>6</b> 建模技术简介</a><ul>
<li class="chapter" data-level="6.1" data-path="section-6.html"><a href="section-6.html#section-6.1"><i class="fa fa-check"></i><b>6.1</b> 有监督和无监督</a></li>
<li class="chapter" data-level="6.2" data-path="section-6.html"><a href="section-6.html#section-6.2"><i class="fa fa-check"></i><b>6.2</b> 误差及其来源</a></li>
<li class="chapter" data-level="6.3" data-path="section-6.html"><a href="section-6.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 数据划分和再抽样</a><ul>
<li class="chapter" data-level="6.3.1" data-path="section-6.html"><a href="section-6.html#section-6.3.1"><i class="fa fa-check"></i><b>6.3.1</b> 划分训练集和测试集</a></li>
<li class="chapter" data-level="6.3.2" data-path="section-6.html"><a href="section-6.html#section-6.3.2"><i class="fa fa-check"></i><b>6.3.2</b> 拟合模型</a></li>
<li class="chapter" data-level="6.3.3" data-path="section-6.html"><a href="section-6.html#section-6.3.3"><i class="fa fa-check"></i><b>6.3.3</b> 评估模型表现</a></li>
<li class="chapter" data-level="6.3.4" data-path="section-6.html"><a href="section-6.html#section-6.3.4"><i class="fa fa-check"></i><b>6.3.4</b> 失衡数据</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-7.html"><a href="section-7.html"><i class="fa fa-check"></i><b>7</b> 特征工程</a><ul>
<li class="chapter" data-level="7.1" data-path="section-7.html"><a href="section-7.html#section-7.1"><i class="fa fa-check"></i><b>7.1</b> 变量选择</a></li>
<li class="chapter" data-level="7.2" data-path="section-7.html"><a href="section-7.html#section-7.2"><i class="fa fa-check"></i><b>7.2</b> 主成分分析</a></li>
<li class="chapter" data-level="7.3" data-path="section-7.html"><a href="section-7.html#section-7.3"><i class="fa fa-check"></i><b>7.3</b> 因子分析</a></li>
<li class="chapter" data-level="7.4" data-path="section-7.html"><a href="section-7.html#section-7.4"><i class="fa fa-check"></i><b>7.4</b> 高维标度化</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-8.html"><a href="section-8.html"><i class="fa fa-check"></i><b>8</b> 线性回归极其衍生</a><ul>
<li class="chapter" data-level="8.1" data-path="section-8.html"><a href="section-8.html#section-8.1"><i class="fa fa-check"></i><b>8.1</b> 普通线性回归</a></li>
<li class="chapter" data-level="8.2" data-path="section-8.html"><a href="section-8.html#section-8.2"><i class="fa fa-check"></i><b>8.2</b> 收缩方法</a></li>
<li class="chapter" data-level="8.3" data-path="section-8.html"><a href="section-8.html#section-8.3"><i class="fa fa-check"></i><b>8.3</b> 分层线性回归</a></li>
<li class="chapter" data-level="8.4" data-path="section-8.html"><a href="section-8.html#section-8.4"><i class="fa fa-check"></i><b>8.4</b> 贝叶斯线性回归</a></li>
<li class="chapter" data-level="8.5" data-path="section-8.html"><a href="section-8.html#section-8.5"><i class="fa fa-check"></i><b>8.5</b> 贝叶斯分层线性回归</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-9.html"><a href="section-9.html"><i class="fa fa-check"></i><b>9</b> 树模型</a><ul>
<li class="chapter" data-level="9.1" data-path="section-9.html"><a href="section-9.html#section-9.1"><i class="fa fa-check"></i><b>9.1</b> 基本树模型</a></li>
<li class="chapter" data-level="9.2" data-path="section-9.html"><a href="section-9.html#section-9.2"><i class="fa fa-check"></i><b>9.2</b> 装袋树</a></li>
<li class="chapter" data-level="9.3" data-path="section-9.html"><a href="section-9.html#section-9.3"><i class="fa fa-check"></i><b>9.3</b> 随机森林</a></li>
<li class="chapter" data-level="9.4" data-path="section-9.html"><a href="section-9.html#section-9.4"><i class="fa fa-check"></i><b>9.4</b> 其它树话题</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-10.html"><a href="section-10.html"><i class="fa fa-check"></i><b>10</b> 聚类判别分析</a><ul>
<li class="chapter" data-level="10.1" data-path="section-10.html"><a href="section-10.html#section-10.1"><i class="fa fa-check"></i><b>10.1</b> 聚类分析</a></li>
<li class="chapter" data-level="10.2" data-path="section-10.html"><a href="section-10.html#section-10.2"><i class="fa fa-check"></i><b>10.2</b> 判别分析</a><ul>
<li class="chapter" data-level="10.2.1" data-path="section-10.html"><a href="section-10.html#section-10.2.1"><i class="fa fa-check"></i><b>10.2.1</b> 逻辑回归</a></li>
<li class="chapter" data-level="10.2.2" data-path="section-10.html"><a href="section-10.html#section-10.2.2"><i class="fa fa-check"></i><b>10.2.2</b> 线性判别分析</a></li>
<li class="chapter" data-level="10.2.3" data-path="section-10.html"><a href="section-10.html#section-10.2.3"><i class="fa fa-check"></i><b>10.2.3</b> 最小二乘判别分析</a></li>
<li class="chapter" data-level="10.2.4" data-path="section-10.html"><a href="section-10.html#section-10.2.4"><i class="fa fa-check"></i><b>10.2.4</b> 朴素贝叶斯</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="section-10.html"><a href="section-10.html#section-10.3"><i class="fa fa-check"></i><b>10.3</b> 案例：客户分组</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-11.html"><a href="section-11.html"><i class="fa fa-check"></i><b>11</b> 关联法则分析</a><ul>
<li class="chapter" data-level="11.1" data-path="section-11.html"><a href="section-11.html#section-11.1"><i class="fa fa-check"></i><b>11.1</b> 关联法则简介</a></li>
<li class="chapter" data-level="11.2" data-path="section-11.html"><a href="section-11.html#section-11.2"><i class="fa fa-check"></i><b>11.2</b> 案例：商业购物篮分析</a></li>
<li class="chapter" data-level="11.3" data-path="section-11.html"><a href="section-11.html#section-11.3"><i class="fa fa-check"></i><b>11.3</b> 关联法则可视化</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-12.html"><a href="section-12.html"><i class="fa fa-check"></i><b>12</b> 数据可视化和结果展示</a><ul>
<li class="chapter" data-level="12.1" data-path="section-12.html"><a href="section-12.html#r-markdown"><i class="fa fa-check"></i><b>12.1</b> R Markdown</a><ul>
<li class="chapter" data-level="12.1.1" data-path="section-12.html"><a href="section-12.html#what-is-r-markdown"><i class="fa fa-check"></i><b>12.1.1</b> What is R Markdown?</a></li>
<li class="chapter" data-level="12.1.2" data-path="section-12.html"><a href="section-12.html#how-to-start"><i class="fa fa-check"></i><b>12.1.2</b> How to Start?</a></li>
<li class="chapter" data-level="12.1.3" data-path="section-12.html"><a href="section-12.html#interactive-r-markdown-document"><i class="fa fa-check"></i><b>12.1.3</b> Interactive R Markdown Document</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="section-13.html"><a href="section-13.html"><i class="fa fa-check"></i><b>13</b> 数据科学的科学</a></li>
<li class="chapter" data-level="14" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>14</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数据科学家：R语言</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-3" class="section level1">
<h1><span class="header-section-number">第3章</span> 数据集模拟和背景介绍</h1>
<p>之后的章节将通过案例讨论建模的各个方面。在进入正题之前，我先用本章介绍书中使用的数据，包括模拟数据的代码，数据的获取以及数据语境背景。很多R包里有现成的数据，网上也有各种机器学习竞赛的数据，但本书用来展示模型的数据大部分是通过R得到的模拟数据集。其原因我在第<a href="index.html#intro">1</a>章开始已经讲过了。</p>
<div id="section-3.1" class="section level2">
<h2><span class="header-section-number">3.1</span> 服装消费者数据</h2>
<p>我们先模拟一个关于某品牌服装消费者的数据，这个数据会在之后的章节中反复用到。数据中包含N=1000个观测，我们将模拟3类变量（括号内是变量对应的模拟数据框中的列标签名）：</p>
<p>（1）人口统计学变量。</p>
<ul>
<li>年龄（age）</li>
<li>性别（gender）</li>
<li>有房还是租房（house）</li>
</ul>
<p>（2）消费者行为变量。</p>
<ul>
<li>2015年实体店购买该品牌服装花销（store_exp）</li>
<li>2015年在线购买该品牌服装花销（online_exp）</li>
<li>2015年实体店交易次数（store_trans）</li>
<li>2015年在线交易次数（online_trans）</li>
</ul>
<p>（3）客户认知问卷调查。为了进一步了解消费者，商家时常对消费者进行问卷调查，然后对调查结果进行分组，其目标是寻找在产品兴趣，市场参与度或营销反应的重要方面有显著差异的客户群。通过了解组间的不同，市场营销人员可以优化产品定位，进行更加精准的营销。这里我们假设该服装品牌对消费者进行了下面的调查，并模拟该调查问卷的回复。</p>
<p>你是否同意下面的申明？</p>
<table>
<thead>
<tr class="header">
<th align="left">问题</th>
<th align="left">1（非常不同意）</th>
<th align="left">2（有点不同意）</th>
<th align="left">3（中立/不知道）</th>
<th align="left">4（有点同意）</th>
<th align="left">5（非常同意）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">（Q1）：我喜欢买不同品牌的服装，比较它们</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q2）：我喜欢买同一个品牌的服装</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q3）：品牌的知名度对我来说非常重要</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q4）：服装质量对我来说非常重要</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q5）：服装风格我喜欢的风格</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q6）：我喜欢在实体店购买</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q7）：我喜欢在网上购买</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q8）：价格对我来说很重要</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">（Q9）：我喜欢不同风格的衣服</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">（Q10）：我喜欢自己挑选服装，不需要周围人的建议</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>我们进一步假设这些根据问卷调查的结果可以将消费者分成4组：价格敏感（Price），炫耀性消费（Conspicuous），质量（Quality），风格（Style）。 （本章我们不会提到如何得到这些分组；我们假设这些已知。我们会在第9章中介绍聚类分析时会更详细的说明。）</p>
<p>你也可以重复下面的代码，自己创建该数据。我们强烈建议读者重复数据模拟的过程，这样能加深对模型方法的理解。如果你对此不感兴趣，也可以从本书网站上直接下载数据：</p>
<pre class="sourceCode r"><code class="sourceCode r">sim.dat&lt;-<span class="kw">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/happyrabbit/DataScientistR/master/Data/SegData.csv&quot;</span>)</code></pre>
<p>获得该数据集后你可以跳过本小节后半部分直接跳到下一节对分析流程的讲解。否则，继续本节。</p>
<p>模拟该数据的过程有些复杂，我们先模拟描述客户的变量。模拟该数据的代码分为3部分：</p>
<ol style="list-style-type: decimal">
<li>定义数据结构：定义变量名，变量类型，消费者分组名，各组大小。</li>
<li>变量分布参数，如各自的均值和方差。</li>
<li>在各组和各个变量上迭代，基于定义和参数设置抽取随机数。</li>
</ol>
<p>通过这种方式组织代码，如果我们要改变部分模拟方式重新抽取数据就比较容易。例如，如果我们想要加一个组，或者改变其中某个人口统计变量的均值，只要稍微改变代码就好。我们也想通过这个结构介绍新的R代码，生成数据的第3个步骤中将用到这些代码。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 设置随机种子，使数据模拟过程可重复</span>
<span class="kw">set.seed</span>(<span class="dv">12345</span>)
<span class="co"># 定义观测数目</span>
ncust&lt;-<span class="dv">1000</span>
<span class="co"># 建立数据框存放模拟观测，初始数据框中只有一列id，即消费者编号</span>
seg_dat&lt;-<span class="kw">data.frame</span>(<span class="dt">id=</span><span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="dv">1</span>:ncust)))
<span class="co"># 指定要生成的变量，并为变量命名</span>
vars&lt;-<span class="kw">c</span>(<span class="st">&quot;age&quot;</span>,<span class="st">&quot;gender&quot;</span>,<span class="st">&quot;income&quot;</span>,<span class="st">&quot;house&quot;</span>,<span class="st">&quot;store_exp&quot;</span>,<span class="st">&quot;online_exp&quot;</span>,<span class="st">&quot;store_trans&quot;</span>,<span class="st">&quot;online_trans&quot;</span>)
<span class="co"># 每个变量对应的数据类型</span>
<span class="co"># norm： 正态分布</span>
<span class="co"># binom: 二项分布</span>
<span class="co"># pois： 泊松分布</span>
vartype&lt;-<span class="kw">c</span>(<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;binom&quot;</span>,<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;binom&quot;</span>,<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;norm&quot;</span>,<span class="st">&quot;pois&quot;</span>,<span class="st">&quot;pois&quot;</span>)
<span class="co"># 四个消费者分组的名称</span>
group_name&lt;-<span class="kw">c</span>(<span class="st">&quot;Price&quot;</span>,<span class="st">&quot;Conspicuous&quot;</span>,<span class="st">&quot;Quality&quot;</span>,<span class="st">&quot;Style&quot;</span>)
<span class="co"># 各消费者群组的大小</span>
group_size&lt;-<span class="kw">c</span>(<span class="dv">250</span>,<span class="dv">200</span>,<span class="dv">200</span>,<span class="dv">350</span>)
<span class="co"># group_name和group_size的第一个元素表明，对于“Price”这组消费者，我们将模拟N=250个观测。</span></code></pre>
<p>定义好了数据的基本结构之后，我们下一步是定义分布参数，用这些参数来抽取相应数据。 这里我们要 模拟的数据有4个样本类，8个非抽样调查变量，因此我们创建一个4×8的均值矩阵，因为不同类别的 消费者对应不同的分布参数。下面代码用来创建均值矩阵：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 定义均值矩阵</span>
mus &lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(
  <span class="co"># 价格敏感（Price）类对应均值</span>
  <span class="dv">60</span>, <span class="fl">0.5</span>, <span class="dv">120000</span>,<span class="fl">0.9</span>, <span class="dv">500</span>,<span class="dv">200</span>,<span class="dv">5</span>,<span class="dv">2</span>,
  <span class="co"># 炫耀性消费（Conspicuous）类对应均值</span>
  <span class="dv">40</span>, <span class="fl">0.7</span>, <span class="dv">200000</span>,<span class="fl">0.9</span>, <span class="dv">5000</span>,<span class="dv">5000</span>,<span class="dv">10</span>,<span class="dv">10</span>,
  <span class="co"># 质量（Quality）类对应均值</span>
  <span class="dv">36</span>, <span class="fl">0.5</span>, <span class="dv">70000</span>, <span class="fl">0.4</span>, <span class="dv">300</span>, <span class="dv">2000</span>,<span class="dv">2</span>,<span class="dv">15</span>,
  <span class="co"># 风格（Style）类对应均值</span>
  <span class="dv">25</span>, <span class="fl">0.2</span>, <span class="dv">90000</span>, <span class="fl">0.2</span>, <span class="dv">200</span>, <span class="dv">2000</span>,<span class="dv">2</span>,<span class="dv">20</span>), <span class="dt">ncol=</span><span class="kw">length</span>(vars), <span class="dt">byrow=</span><span class="ot">TRUE</span>)</code></pre>
<p>具体过程是怎样的？ 均值矩阵<code>mus</code>指定，例如，价格敏感（Price）类群体的第一个变量（这里是年龄age）均值为60，炫耀性消费（Conspicuous）类群体的年龄均值为40依次类推。正态分布变量需要指定均值和方差，如年龄（<code>age</code>）， 实体店花销（<code>store_exp</code>）和在线花销（<code>online_exp</code>）。对于二项分布（只有两个可能取值）和泊松分布变量，我们只需要规定均值。其中，性别（<code>gender</code>），有房还是租房（<code>house</code>）是二项数据，生成这样的数据需要指定得到其中某一观测值的概率，比如矩阵<code>mus</code>中。实体店交易次数（<code>store_trans</code>）和线交易次数（<code>online_trans</code>）是泊松变量（频数），泊松分布只有一个参数——分布均值。所以在下面的标准差矩阵<code>sds</code>中，非正态分布变量对应的标准差为缺失值<code>NA</code>。（注意这里我们只是用这些分布为例生成数据，并不意味着这些是最好的拟合变量观测的分布。例如，真实的收入数据更可能是一个有偏的分布而非正态）。</p>
<p>下面我们对正态分布变量创建标准差矩阵：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 每类的标准差 (NA = 标准差无定义)</span>
sds&lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(
  <span class="co"># 价格敏感（Price）类对应均值</span>
  <span class="dv">3</span>,<span class="ot">NA</span>,<span class="dv">8000</span>,<span class="ot">NA</span>,<span class="dv">100</span>,<span class="dv">50</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,
  <span class="co"># 炫耀性消费（Conspicuous）类对应均值</span>
  <span class="dv">5</span>,<span class="ot">NA</span>,<span class="dv">50000</span>,<span class="ot">NA</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,
  <span class="co"># 质量（Quality）类对应均值</span>
  <span class="dv">7</span>,<span class="ot">NA</span>,<span class="dv">10000</span>,<span class="ot">NA</span>,<span class="dv">50</span>,<span class="dv">200</span>,<span class="ot">NA</span>,<span class="ot">NA</span>,
  <span class="co"># 风格（Style）类对应均值</span>
  <span class="dv">2</span>,<span class="ot">NA</span>,<span class="dv">5000</span>,<span class="ot">NA</span>,<span class="dv">10</span>,<span class="dv">500</span>,<span class="ot">NA</span>,<span class="ot">NA</span>), <span class="dt">ncol=</span><span class="kw">length</span>(vars), <span class="dt">byrow=</span><span class="ot">TRUE</span>)</code></pre>
<p>将这两个矩阵加在一起我们就能够完全定义各个类的分布了。例如，我们来看下每个矩阵的第1行，其代表第1类群体（价格敏感）的分布参数。这些值规定该类群体的年龄（age）均值为60（见第一个矩阵第1行第1列），标准差为3（第二个矩阵第1行第1列）。另外，其中大约有50%的男性（第一个矩阵第1行第2列），年收入（income）均值为120000元，标准差为8000元。将这些设置分开存在不同表格中，将来想要修改十分容易。将数据定义和抽样过程分开是个很好的习惯。下面开始抽取数据：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 抽取非抽样调查数据</span>
sim.dat&lt;-<span class="ot">NULL</span>
<span class="kw">set.seed</span>(<span class="dv">2016</span>)
<span class="co"># 对消费者类别进行循环（i）</span>
 for (i in <span class="kw">seq_along</span>(group_name)){
   <span class="co"># 为了核实代码，展示循环运行过程，我们在循环中添加了这样一行代码</span>
   <span class="co"># 函数运行时会打印出正在抽取的样本类名</span>
   <span class="kw">cat</span> (i, group_name[i],<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
  <span class="co"># 创建一个空矩阵用于存放该类消费者相关数据</span>
  seg&lt;-<span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>group_size[i], <span class="dt">ncol=</span><span class="kw">length</span>(vars)))  
  <span class="co"># 在这个类之内，对不同变量迭代，抽取相应的随机数据</span>
  for (j in <span class="kw">seq_along</span>(vars)){
    <span class="co"># 在每个变量上迭代</span>
    if (vartype[j]==<span class="st">&quot;norm&quot;</span>){
      <span class="co"># 抽取正态分布变量</span>
      seg[,j]&lt;-<span class="kw">rnorm</span>(group_size[i], <span class="dt">mean=</span>mus[i,j], <span class="dt">sd=</span>sds[i,j])
    } else if (vartype[j]==<span class="st">&quot;pois&quot;</span>) {
      <span class="co"># 抽取泊松分布变量</span>
      seg[,j]&lt;-<span class="kw">rpois</span>(group_size[i], <span class="dt">lambda=</span>mus[i,j])
    } else if (vartype[j]==<span class="st">&quot;binom&quot;</span>){
      <span class="co"># 抽取二项分布变量</span>
      seg[,j]&lt;-<span class="kw">rbinom</span>(group_size[i],<span class="dt">size=</span><span class="dv">1</span>,<span class="dt">prob=</span>mus[i,j])
    } else{
      <span class="co"># 如果变量类型不是上述几种，程序停止运行并提示信息</span>
      <span class="kw">stop</span> (<span class="st">&quot;Don&#39;t have type:&quot;</span>,vartype[j])
    }        
  }
  <span class="co"># 将该消费者类的数据依行添加到总数据集</span>
  sim.dat&lt;-<span class="kw">rbind</span>(sim.dat,seg)
 }</code></pre>
<pre><code>## 1 Price 
## 2 Conspicuous 
## 3 Quality 
## 4 Style</code></pre>
<p>上面的代码是随机抽样的主要过程，其中<code>cat()</code>函数使得循环运行时会打印出正在抽取的样本类名，最后得到的<code>sim.dat</code>是初始描述客户的变量部分的数据，在对数据进行润色前，提醒大家注意两个关于R的技巧：</p>
<p>第一、在i循环内，我们事先定义一个有着相应行数和列数的没有元素值的数据框<code>seg</code>，之后每迭代一次就将样本赋值到事先定义的<code>seg</code>的特定行。这么做的原因是由于只要R在某个对象上添加东西——如在数据框上增加一行——它都会将原对象拷贝一份。这将使用两倍的内存，减慢运行速度。通过这种方法可以避免对内存的浪费。对这里的小数据可能感觉不出差别，但对于大数据，运行速度会有极大不同。</p>
<p>第二、对循环指针范围的设定用的是<code>seq_along()</code>而非<code>1:length()</code>。这是为了够避免一些常见的错误，如指针向量长度为0或者不经意将向量方向弄反了。</p>
<p>之后我们对描述客户的这部分数据进行完善，添加合适的列标签，将二项（0/1）变量转化为贴有标签的因子变量。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 指定数据框的列名为我们定义的变量名</span>
<span class="kw">names</span>(sim.dat)&lt;-vars
<span class="co"># 加上一个因子列表明每个观测的对应的消费者类别</span>
sim.dat$segment&lt;-<span class="kw">factor</span>(<span class="kw">rep</span>(group_name,<span class="dt">times=</span>group_size))
<span class="co"># 将二项变量转化为贴有标签的因子变量</span>
<span class="co"># Female: 女性</span>
<span class="co"># Male: 男性</span>
sim.dat$gender&lt;-<span class="kw">factor</span>(sim.dat$gender, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Male&quot;</span>))
sim.dat$house&lt;-<span class="kw">factor</span>(sim.dat$house, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))
<span class="co"># 假设在线购买和在实体店购买的次数至少为1，所以这里在原随机值上加1</span>
sim.dat$store_trans&lt;-sim.dat$store_trans<span class="dv">+1</span>
sim.dat$online_trans&lt;-sim.dat$online_trans<span class="dv">+1</span>
<span class="co"># 年龄为整数</span>
sim.dat$age&lt;-<span class="kw">floor</span>(sim.dat$age)</code></pre>
<p>真实市场营销数据往往没有这么干净，数据缺失，以及错误输入等问题常常发生。我们最后对模拟的数据做一点“破坏”，使其更像真实的数据。我们假设一些人不愿意给出关于收入（<code>income</code>）的信息。我们建立一个逻辑变量<code>idxm</code>，然后将逻辑变量<code>idxm</code>值为真的对应位置消费者收入观测设为缺失值<code>NA</code>（R用<code>NA</code>表示缺失值）。我们假设年龄（age）越大的消费者对应缺失值的概率越大：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 加入缺失值</span>
idxm &lt;-<span class="st"> </span><span class="kw">as.logical</span>(<span class="kw">rbinom</span>(ncust, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span>sim.dat$age/<span class="dv">200</span>))
sim.dat$income[idxm]&lt;-<span class="ot">NA</span></code></pre>
<p>真实的数据中可能有错误的输入，或者离群点：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 错误输入，离群点</span>
<span class="kw">set.seed</span>(<span class="dv">123</span>)
idx&lt;-<span class="kw">sample</span>(<span class="dv">1</span>:ncust,<span class="dv">5</span>)
sim.dat$age[idx[<span class="dv">1</span>]]&lt;-<span class="dv">300</span>
sim.dat$store_exp[idx[<span class="dv">2</span>]]&lt;-<span class="st"> </span>-<span class="dv">500</span>
sim.dat$store_exp[idx[<span class="dv">3</span>:<span class="dv">5</span>]]&lt;-<span class="kw">c</span>(<span class="dv">50000</span>,<span class="dv">30000</span>,<span class="dv">30000</span>)</code></pre>
<p>到目前为止我们已经建立了一部分数据，你可以通过<code>summary(sim.dat)</code>检查数据。下面我们接着抽取问卷调查回复数据。我们先通过<code>rnorm()</code>生成正态分布随机数。但从上面的问卷调查表格中可以看到，这是一个1-5分量级的问卷，1代表非常不同意，5代表非常同意。于是接下来我们通过<code>floor()</code>函数将连续值转化成离散整数。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 抽取问卷调查回复</span>
<span class="co"># 问卷问题数目</span>
nq&lt;-<span class="dv">10</span>
<span class="co"># 各类消费者对问卷回复的正态分布均值矩阵</span>
mus2 &lt;-<span class="st"> </span><span class="kw">matrix</span>( <span class="kw">c</span>(
  <span class="co"># 价格敏感（Price）类对应均值</span>
 <span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,
  <span class="co"># 炫耀性消费（Conspicuous）类对应均值</span>
 <span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>,
  <span class="co"># 质量（Quality）类对应均值</span>
 <span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,
  <span class="co"># 风格（Style）类对应均值</span>
 <span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>), <span class="dt">ncol=</span>nq, <span class="dt">byrow=</span><span class="ot">TRUE</span>)

<span class="co"># 方差假设都是0.2</span>
sd2&lt;-<span class="fl">0.2</span>
sim.dat2&lt;-<span class="ot">NULL</span>
<span class="kw">set.seed</span>(<span class="dv">1000</span>)
<span class="co"># 对消费者类别进行循环（i）</span>
for (i in <span class="kw">seq_along</span>(group_name)){
  <span class="co"># 为了核实代码，展示循环运行过程，我们在循环中添加了这样一行代码</span>
  <span class="co"># 函数运行时会打印出正在抽取的样本类名，这里不再显示输出</span>
  <span class="co"># cat (i, group_name[i],&quot;\n&quot;)</span>
  <span class="co"># 创建一个空矩阵用于存放该类消费者相关数据</span>
  seg&lt;-<span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>group_size[i], <span class="dt">ncol=</span>nq))  
  <span class="co"># 在这个类之内，对不同变量迭代，抽取相应的随机数据</span>
  for (j in <span class="dv">1</span>:nq){
    <span class="co"># 抽取正态分布变量</span>
    res&lt;-<span class="kw">rnorm</span>(group_size[i], <span class="dt">mean=</span>mus2[i,j], <span class="dt">sd=</span>sd2)
    <span class="co"># 设置上下限度</span>
    res[res&gt;<span class="dv">5</span>]&lt;-<span class="dv">5</span>
    res[res&lt;<span class="dv">1</span>]&lt;-<span class="dv">1</span>
    <span class="co"># 通过 floor()函数将连续值转化成离散整数。</span>
    seg[,j]&lt;-<span class="kw">floor</span>(res)
  }
  <span class="co"># 将该消费者类的数据添加到总数据集</span>
  sim.dat2&lt;-<span class="kw">rbind</span>(sim.dat2,seg)
}

<span class="co"># 为数据框添加列标签</span>
<span class="kw">names</span>(sim.dat2)&lt;-<span class="kw">paste</span>(<span class="st">&quot;Q&quot;</span>,<span class="dv">1</span>:<span class="dv">10</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
<span class="co"># 合并两部分数据</span>
sim.dat&lt;-<span class="kw">cbind</span>(sim.dat,sim.dat2)
<span class="co"># 加上一个因子列表明每个观测的对应的消费者类别</span>
sim.dat$segment&lt;-<span class="kw">factor</span>(<span class="kw">rep</span>(group_name,<span class="dt">times=</span>group_size))</code></pre>
<p>至此为止我们得到了需要的数据集。让我们检查一下抽取的数据集：</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(sim.dat,<span class="dt">vec.len=</span><span class="dv">3</span>)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  19 variables:
##  $ age         : num  57 63 59 60 51 59 57 57 ...
##  $ gender      : Factor w/ 2 levels &quot;Female&quot;,&quot;Male&quot;: 1 1 2 2 2 2 2 2 ...
##  $ income      : num  120963 122008 114202 113616 ...
##  $ house       : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 ...
##  $ store_exp   : num  529 478 491 348 ...
##  $ online_exp  : num  304 110 279 142 ...
##  $ store_trans : num  2 4 7 10 4 4 5 11 ...
##  $ online_trans: num  2 2 2 2 4 5 3 5 ...
##  $ segment     : Factor w/ 4 levels &quot;Conspicuous&quot;,..: 2 2 2 2 2 2 2 2 ...
##  $ Q1          : num  4 4 5 5 4 4 4 5 ...
##  $ Q2          : num  2 1 2 2 1 2 1 2 ...
##  $ Q3          : num  1 1 1 1 1 1 1 1 ...
##  $ Q4          : num  2 2 2 3 3 2 2 3 ...
##  $ Q5          : num  1 1 1 1 1 1 1 1 ...
##  $ Q6          : num  4 4 4 4 4 3 3 3 ...
##  $ Q7          : num  1 1 1 1 1 1 1 1 ...
##  $ Q8          : num  4 3 3 4 4 3 3 4 ...
##  $ Q9          : num  2 1 1 2 2 1 1 2 ...
##  $ Q10         : num  4 4 3 3 4 3 4 3 ...</code></pre>
<p>可以看到，服装消费者数据有1000个观测，19个变量。前8个变量是关于样本的人口统计学和购买行为描述。Q1-Q10是关于消费者选择偏好的问卷调查回复，问卷分值量表为1-5分（最常见的市场调查设计）。最后一列是消费者类别，样本观测的模拟是根据消费者类别进行的，因此这些可以当作“真实”的消费者类别。使用随机模拟的一个重要优点就是能够通过这种方式验证模型的效果。而实际生活中的数据样本真正所属类别通常是未知的。我们在之后对聚类和判别分析进行介绍的时候会使用样本类别信息。下面我们会反复用该数据集为例。</p>
</div>
<div id="section-3.2" class="section level2">
<h2><span class="header-section-number">3.2</span> 航空公司满意度调查</h2>
<p>这一小节我们模拟一个航空公司满意度调查数据。数据中包含N=1000个受访者，每个受访者基于最近一次航班体验对3个航空公司进行评分，问卷调查一共15项，每项评分从1-9，分值越大满意度越高。这15个调查项分为4类：</p>
<ol style="list-style-type: decimal">
<li>购票体验
<ul>
<li>购票容易度</li>
<li>座椅选择</li>
<li>航班选择</li>
<li>票价</li>
</ul></li>
<li>机舱设施
<ul>
<li>座椅舒适度</li>
<li>位置前后空间</li>
<li>随机行李存放</li>
<li>机舱清洁</li>
</ul></li>
<li>空航服务
<ul>
<li>礼貌</li>
<li>友善</li>
<li>能够提供需要的帮助</li>
<li>食物饮料服务</li>
</ul></li>
<li>推荐指数
<ul>
<li>总体满意度</li>
<li>再次选择次航空公司</li>
<li>向朋友推荐此航空公司</li>
</ul></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># R Code to Generate the Simulated Data and Run All Analyses</span>
<span class="co"># The goal is to show all the R code that you would need</span>
<span class="co"># to reproduce everything that has been reported.</span>
<span class="co"># We will use the mvtnorm package in order to randomly </span>
<span class="co"># generate a data set with a given correlation pattern.</span>

<span class="co"># First, we create a matrix of factor loadings.</span>
<span class="co"># This pattern is called bifactor because it has a </span>
<span class="co"># general factor with loadings from all the items</span>
<span class="co"># and specific factors for separate components.</span>
<span class="co"># The outcome variables are also formed as </span>
<span class="co"># combinations of these general and specific factors.</span>

loadings &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span> (
  <span class="co"># ticketing</span>
  .<span class="dv">33</span>, .<span class="dv">58</span>, .<span class="dv">00</span>, .<span class="dv">00</span>,  <span class="co"># Ease of Making Reservation </span>
  .<span class="dv">35</span>, .<span class="dv">55</span>, .<span class="dv">00</span>, .<span class="dv">00</span>,  <span class="co"># Availability of Preferred Seats</span>
  .<span class="dv">30</span>, .<span class="dv">52</span>, .<span class="dv">00</span>, .<span class="dv">00</span>,  <span class="co"># Variety of Flight Options</span>
  .<span class="dv">40</span>, .<span class="dv">50</span>, .<span class="dv">00</span>, .<span class="dv">00</span>,  <span class="co"># Ticket Prices</span>
  <span class="co"># aircraft</span>
  .<span class="dv">50</span>, .<span class="dv">00</span>, .<span class="dv">55</span>, .<span class="dv">00</span>,  <span class="co"># Seat Comfort</span>
  .<span class="dv">41</span>, .<span class="dv">00</span>, .<span class="dv">51</span>, .<span class="dv">00</span>,  <span class="co"># Roominess of Seat Area</span>
  .<span class="dv">45</span>, .<span class="dv">00</span>, .<span class="dv">57</span>, .<span class="dv">00</span>,  <span class="co"># Availability of Overhead Storage</span>
  .<span class="dv">32</span>, .<span class="dv">00</span>, .<span class="dv">54</span>, .<span class="dv">00</span>,  <span class="co"># Cleanliness of Aircraft</span>
  <span class="co"># customer service</span>
  .<span class="dv">35</span>, .<span class="dv">00</span>, .<span class="dv">00</span>, .<span class="dv">50</span>,  <span class="co"># Courtesy</span>
  .<span class="dv">38</span>, .<span class="dv">00</span>, .<span class="dv">00</span>, .<span class="dv">57</span>,  <span class="co"># Friendliness</span>
  .<span class="dv">60</span>, .<span class="dv">00</span>, .<span class="dv">00</span>, .<span class="dv">50</span>,  <span class="co"># Helpfulness</span>
  .<span class="dv">52</span>, .<span class="dv">00</span>, .<span class="dv">00</span>, .<span class="dv">58</span>,  <span class="co"># Service</span>
  <span class="co"># overall satisfaction, recommendation and repurchase  </span>
  .<span class="dv">43</span>, .<span class="dv">10</span>, .<span class="dv">20</span>, .<span class="dv">30</span>,  <span class="co"># Overall Satisfaction</span>
  .<span class="dv">35</span>, .<span class="dv">50</span>, .<span class="dv">40</span>, .<span class="dv">20</span>,  <span class="co"># Purchase Intention</span>
  .<span class="dv">25</span>, .<span class="dv">50</span>, .<span class="dv">50</span>, .<span class="dv">00</span>), <span class="co"># Willingness to Recommend</span>
  <span class="dt">nrow=</span><span class="dv">15</span>,<span class="dt">ncol=</span><span class="dv">4</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)

<span class="co"># Matrix multiplication produces the correlation matrix, </span>
<span class="co"># except for the diagonal.</span>
cor_matrix&lt;-loadings %*%<span class="st"> </span><span class="kw">t</span>(loadings)
<span class="co"># Diagonal set to ones.</span>
<span class="kw">diag</span>(cor_matrix)&lt;-<span class="dv">1</span>

<span class="kw">library</span>(mvtnorm)
N=<span class="dv">1000</span>
<span class="kw">set.seed</span>(<span class="dv">7654321</span>) <span class="co">#needed in order to reproduce the same data each time</span>
std_ratings&lt;-<span class="kw">as.data.frame</span>(<span class="kw">rmvnorm</span>(N, <span class="dt">sigma=</span>cor_matrix))

ratings&lt;-<span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">15000</span>),<span class="dt">nrow=</span><span class="dv">1000</span>))
ratings[<span class="dv">1</span>:<span class="dv">1000</span>,]&lt;-std_ratings[<span class="dv">1</span>:<span class="dv">1000</span>,]*<span class="dv">2</span><span class="fl">+4.0</span>

<span class="co"># Ratings given different means</span>
ratings[<span class="dv">1</span>]&lt;-ratings[<span class="dv">1</span>]+<span class="fl">2.2</span>
ratings[<span class="dv">2</span>]&lt;-ratings[<span class="dv">2</span>]+<span class="fl">0.6</span>
ratings[<span class="dv">3</span>]&lt;-ratings[<span class="dv">3</span>]+<span class="fl">0.3</span>
ratings[<span class="dv">4</span>]&lt;-ratings[<span class="dv">4</span>]+<span class="fl">0.0</span>
ratings[<span class="dv">5</span>]&lt;-ratings[<span class="dv">5</span>]+<span class="fl">1.5</span>
ratings[<span class="dv">6</span>]&lt;-ratings[<span class="dv">6</span>]+<span class="fl">1.0</span>
ratings[<span class="dv">7</span>]&lt;-ratings[<span class="dv">7</span>]+<span class="fl">0.5</span>
ratings[<span class="dv">8</span>]&lt;-ratings[<span class="dv">8</span>]+<span class="fl">1.5</span>
ratings[<span class="dv">9</span>]&lt;-ratings[<span class="dv">9</span>]+<span class="fl">2.4</span>
ratings[<span class="dv">10</span>]&lt;-ratings[<span class="dv">10</span>]+<span class="fl">2.2</span>
ratings[<span class="dv">11</span>]&lt;-ratings[<span class="dv">11</span>]+<span class="fl">2.1</span>
ratings[<span class="dv">12</span>]&lt;-ratings[<span class="dv">12</span>]+<span class="fl">2.0</span>
ratings[<span class="dv">13</span>]&lt;-ratings[<span class="dv">13</span>]+<span class="fl">1.5</span>
ratings[<span class="dv">14</span>]&lt;-ratings[<span class="dv">14</span>]+<span class="fl">1.0</span>
ratings[<span class="dv">15</span>]&lt;-ratings[<span class="dv">15</span>]+<span class="fl">0.5</span>

<span class="co"># Truncates Scale to be between 1 and 9</span>
ratings[ratings&gt;<span class="dv">9</span>]&lt;-<span class="dv">9</span>
ratings[ratings&lt;<span class="dv">1</span>]&lt;-<span class="dv">1</span>
<span class="co"># Rounds to single digit.</span>
ratings&lt;-<span class="kw">round</span>(ratings,<span class="dv">0</span>)

<span class="co"># Assigns names to the variables in the data frame called ratings</span>
<span class="kw">names</span>(ratings)=<span class="kw">c</span>(
  <span class="st">&quot;Easy_Reservation&quot;</span>,
  <span class="st">&quot;Preferred_Seats&quot;</span>,
  <span class="st">&quot;Flight_Options&quot;</span>,
  <span class="st">&quot;Ticket_Prices&quot;</span>,
  <span class="st">&quot;Seat_Comfort&quot;</span>,
  <span class="st">&quot;Seat_Roominess&quot;</span>,
  <span class="st">&quot;Overhead_Storage&quot;</span>,
  <span class="st">&quot;Clean_Aircraft&quot;</span>,
  <span class="st">&quot;Courtesy&quot;</span>,
  <span class="st">&quot;Friendliness&quot;</span>,
  <span class="st">&quot;Helpfulness&quot;</span>,
  <span class="st">&quot;Service&quot;</span>,
  <span class="st">&quot;Satisfaction&quot;</span>,
  <span class="st">&quot;Fly_Again&quot;</span>,
  <span class="st">&quot;Recommend&quot;</span>)
ratingsA&lt;-ratings

<span class="kw">summary</span>(ratingsA)</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-4.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/index.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>


</body>

</html>
