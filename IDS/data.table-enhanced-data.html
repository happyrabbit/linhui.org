<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13.2 data.table— enhanced data.frame | Practitioner’s Guide to Data Science</title>
  <meta name="description" content="Introduction to Data Science" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="13.2 data.table— enhanced data.frame | Practitioner’s Guide to Data Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://scientistcafe.com/IDS/" />
  
  <meta property="og:description" content="Introduction to Data Science" />
  <meta name="github-repo" content="happyrabbit/IntroDataScience" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13.2 data.table— enhanced data.frame | Practitioner’s Guide to Data Science" />
  
  <meta name="twitter:description" content="Introduction to Data Science" />
  

<meta name="author" content="Hui Lin and Ming Li" />


<meta name="date" content="2023-04-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="readr.html"/>
<link rel="next" href="r-code-for-data-simulation.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://scientistcafe.com">Homepage</a></li>

<li class="divider"></li>
<li><a href="index.html#preface" id="toc-preface">Preface</a>
<ul>
<li><a href="goal-of-the-book.html#goal-of-the-book" id="toc-goal-of-the-book">Goal of the Book</a></li>
<li><a href="what-this-book-covers.html#what-this-book-covers" id="toc-what-this-book-covers">What This Book Covers</a></li>
<li><a href="who-this-book-is-for.html#who-this-book-is-for" id="toc-who-this-book-is-for">Who This Book Is For</a></li>
<li><a href="how-to-use-this-book.html#how-to-use-this-book" id="toc-how-to-use-this-book">How to Use This Book</a>
<ul>
<li><a href="how-to-use-this-book.html#what-the-book-assumes" id="toc-what-the-book-assumes">What the Book Assumes</a></li>
<li><a href="how-to-use-this-book.html#how-to-run-r-and-python-code" id="toc-how-to-run-r-and-python-code">How to Run R and Python Code</a></li>
</ul></li>
<li><a href="complementary-reading.html#complementary-reading" id="toc-complementary-reading">Complementary Reading</a></li>
</ul></li>
<li><a href="about-the-authors.html#about-the-authors" id="toc-about-the-authors">About the Authors</a></li>
<li><a href="introduction.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="a-brief-history-of-data-science.html#a-brief-history-of-data-science" id="toc-a-brief-history-of-data-science"><span class="toc-section-number">1.1</span> A Brief History of Data Science</a></li>
<li><a href="data-science-role-and-skill-tracks.html#data-science-role-and-skill-tracks" id="toc-data-science-role-and-skill-tracks"><span class="toc-section-number">1.2</span> Data Science Role and Skill Tracks</a>
<ul>
<li><a href="data-science-role-and-skill-tracks.html#engineering" id="toc-engineering"><span class="toc-section-number">1.2.1</span> Engineering</a></li>
<li><a href="data-science-role-and-skill-tracks.html#analysis" id="toc-analysis"><span class="toc-section-number">1.2.2</span> Analysis</a></li>
<li><a href="data-science-role-and-skill-tracks.html#modelinginference" id="toc-modelinginference"><span class="toc-section-number">1.2.3</span> Modeling/Inference</a></li>
</ul></li>
<li><a href="what-kind-of-questions-can-data-science-solve.html#what-kind-of-questions-can-data-science-solve" id="toc-what-kind-of-questions-can-data-science-solve"><span class="toc-section-number">1.3</span> What Kind of Questions Can Data Science Solve?</a>
<ul>
<li><a href="what-kind-of-questions-can-data-science-solve.html#prerequisites" id="toc-prerequisites"><span class="toc-section-number">1.3.1</span> Prerequisites</a></li>
<li><a href="what-kind-of-questions-can-data-science-solve.html#problem-type" id="toc-problem-type"><span class="toc-section-number">1.3.2</span> Problem Type</a></li>
</ul></li>
<li><a href="structure-of-data-science-team.html#structure-of-data-science-team" id="toc-structure-of-data-science-team"><span class="toc-section-number">1.4</span> Structure of Data Science Team</a></li>
<li><a href="data-science-roles.html#data-science-roles" id="toc-data-science-roles"><span class="toc-section-number">1.5</span> Data Science Roles</a></li>
</ul></li>
<li><a href="SoftSkillsforDataScientists.html#SoftSkillsforDataScientists" id="toc-SoftSkillsforDataScientists"><span class="toc-section-number">2</span> Soft Skills for Data Scientists</a>
<ul>
<li><a href="comparison-between-statistician-and-data-scientist.html#comparison-between-statistician-and-data-scientist" id="toc-comparison-between-statistician-and-data-scientist"><span class="toc-section-number">2.1</span> Comparison between Statistician and Data Scientist</a></li>
<li><a href="beyond-data-and-analytics.html#beyond-data-and-analytics" id="toc-beyond-data-and-analytics"><span class="toc-section-number">2.2</span> Beyond Data and Analytics</a></li>
<li><a href="three-pillars-of-knowledge.html#three-pillars-of-knowledge" id="toc-three-pillars-of-knowledge"><span class="toc-section-number">2.3</span> Three Pillars of Knowledge</a></li>
<li><a href="data-science-project-cycle.html#data-science-project-cycle" id="toc-data-science-project-cycle"><span class="toc-section-number">2.4</span> Data Science Project Cycle</a>
<ul>
<li><a href="data-science-project-cycle.html#types-of-data-science-projects" id="toc-types-of-data-science-projects"><span class="toc-section-number">2.4.1</span> Types of Data Science Projects</a></li>
<li><a href="data-science-project-cycle.html#ProblemFormulationandProjectPlanningStage" id="toc-ProblemFormulationandProjectPlanningStage"><span class="toc-section-number">2.4.2</span> Problem Formulation and Project Planning Stage</a></li>
<li><a href="data-science-project-cycle.html#project-modeling-stage" id="toc-project-modeling-stage"><span class="toc-section-number">2.4.3</span> Project Modeling Stage</a></li>
<li><a href="data-science-project-cycle.html#ModelImplementationandPostProductionStage" id="toc-ModelImplementationandPostProductionStage"><span class="toc-section-number">2.4.4</span> Model Implementation and Post Production Stage</a></li>
<li><a href="data-science-project-cycle.html#ProjectCycleSummary" id="toc-ProjectCycleSummary"><span class="toc-section-number">2.4.5</span> Project Cycle Summary</a></li>
</ul></li>
<li><a href="common-mistakes-in-data-science.html#common-mistakes-in-data-science" id="toc-common-mistakes-in-data-science"><span class="toc-section-number">2.5</span> Common Mistakes in Data Science</a>
<ul>
<li><a href="common-mistakes-in-data-science.html#problem-formulation-stage" id="toc-problem-formulation-stage"><span class="toc-section-number">2.5.1</span> Problem Formulation Stage</a></li>
<li><a href="common-mistakes-in-data-science.html#project-planning-stage" id="toc-project-planning-stage"><span class="toc-section-number">2.5.2</span> Project Planning Stage</a></li>
<li><a href="common-mistakes-in-data-science.html#project-modeling-stage-1" id="toc-project-modeling-stage-1"><span class="toc-section-number">2.5.3</span> Project Modeling Stage</a></li>
<li><a href="common-mistakes-in-data-science.html#model-implementation-and-post-production-stage" id="toc-model-implementation-and-post-production-stage"><span class="toc-section-number">2.5.4</span> Model Implementation and Post Production Stage</a></li>
<li><a href="common-mistakes-in-data-science.html#summary-of-common-mistakes" id="toc-summary-of-common-mistakes"><span class="toc-section-number">2.5.5</span> Summary of Common Mistakes</a></li>
</ul></li>
</ul></li>
<li><a href="introduction-to-the-data.html#introduction-to-the-data" id="toc-introduction-to-the-data"><span class="toc-section-number">3</span> Introduction to the Data</a>
<ul>
<li><a href="customer-data-for-a-clothing-company.html#customer-data-for-a-clothing-company" id="toc-customer-data-for-a-clothing-company"><span class="toc-section-number">3.1</span> Customer Data for a Clothing Company</a></li>
<li><a href="swinediseasedata.html#swinediseasedata" id="toc-swinediseasedata"><span class="toc-section-number">3.2</span> Swine Disease Breakout Data</a></li>
<li><a href="mnist-dataset.html#mnist-dataset" id="toc-mnist-dataset"><span class="toc-section-number">3.3</span> MNIST Dataset</a></li>
<li><a href="imdb-dataset.html#imdb-dataset" id="toc-imdb-dataset"><span class="toc-section-number">3.4</span> IMDB Dataset</a></li>
</ul></li>
<li><a href="bigdatacloudplatform.html#bigdatacloudplatform" id="toc-bigdatacloudplatform"><span class="toc-section-number">4</span> Big Data Cloud Platform</a>
<ul>
<li><a href="power-of-cluster-of-computers.html#power-of-cluster-of-computers" id="toc-power-of-cluster-of-computers"><span class="toc-section-number">4.1</span> Power of Cluster of Computers</a></li>
<li><a href="evolution-of-cluster-computing.html#evolution-of-cluster-computing" id="toc-evolution-of-cluster-computing"><span class="toc-section-number">4.2</span> Evolution of Cluster Computing</a>
<ul>
<li><a href="evolution-of-cluster-computing.html#hadoop" id="toc-hadoop"><span class="toc-section-number">4.2.1</span> Hadoop</a></li>
<li><a href="evolution-of-cluster-computing.html#spark" id="toc-spark"><span class="toc-section-number">4.2.2</span> Spark</a></li>
</ul></li>
<li><a href="CloudEnvironment.html#CloudEnvironment" id="toc-CloudEnvironment"><span class="toc-section-number">4.3</span> Introduction of Cloud Environment</a>
<ul>
<li><a href="CloudEnvironment.html#open-account-and-create-a-cluster" id="toc-open-account-and-create-a-cluster"><span class="toc-section-number">4.3.1</span> Open Account and Create a Cluster</a></li>
<li><a href="CloudEnvironment.html#r-notebook" id="toc-r-notebook"><span class="toc-section-number">4.3.2</span> R Notebook</a></li>
<li><a href="CloudEnvironment.html#markdown-cells" id="toc-markdown-cells"><span class="toc-section-number">4.3.3</span> Markdown Cells</a></li>
</ul></li>
<li><a href="leveragesparkr.html#leveragesparkr" id="toc-leveragesparkr"><span class="toc-section-number">4.4</span> Leverage Spark Using R Notebook</a></li>
<li><a href="databases-and-sql.html#databases-and-sql" id="toc-databases-and-sql"><span class="toc-section-number">4.5</span> Databases and SQL</a>
<ul>
<li><a href="databases-and-sql.html#history" id="toc-history"><span class="toc-section-number">4.5.1</span> History</a></li>
<li><a href="databases-and-sql.html#database-table-and-view" id="toc-database-table-and-view"><span class="toc-section-number">4.5.2</span> Database, Table and View</a></li>
<li><a href="databases-and-sql.html#basic-sql-statement" id="toc-basic-sql-statement"><span class="toc-section-number">4.5.3</span> Basic SQL Statement</a></li>
<li><a href="databases-and-sql.html#advanced-topics-in-database" id="toc-advanced-topics-in-database"><span class="toc-section-number">4.5.4</span> Advanced Topics in Database</a></li>
</ul></li>
</ul></li>
<li><a href="datapreprocessing.html#datapreprocessing" id="toc-datapreprocessing"><span class="toc-section-number">5</span> Data Pre-processing</a>
<ul>
<li><a href="data-cleaning.html#data-cleaning" id="toc-data-cleaning"><span class="toc-section-number">5.1</span> Data Cleaning</a></li>
<li><a href="missing-values.html#missing-values" id="toc-missing-values"><span class="toc-section-number">5.2</span> Missing Values</a>
<ul>
<li><a href="missing-values.html#impute-missing-values-with-medianmode" id="toc-impute-missing-values-with-medianmode"><span class="toc-section-number">5.2.1</span> Impute missing values with median/mode</a></li>
<li><a href="missing-values.html#k-nearest-neighbors" id="toc-k-nearest-neighbors"><span class="toc-section-number">5.2.2</span> K-nearest neighbors</a></li>
<li><a href="missing-values.html#bagging-tree" id="toc-bagging-tree"><span class="toc-section-number">5.2.3</span> Bagging Tree</a></li>
</ul></li>
<li><a href="centering-and-scaling.html#centering-and-scaling" id="toc-centering-and-scaling"><span class="toc-section-number">5.3</span> Centering and Scaling</a></li>
<li><a href="resolve-skewness.html#resolve-skewness" id="toc-resolve-skewness"><span class="toc-section-number">5.4</span> Resolve Skewness</a></li>
<li><a href="outliers.html#outliers" id="toc-outliers"><span class="toc-section-number">5.5</span> Resolve Outliers</a></li>
<li><a href="collinearity.html#collinearity" id="toc-collinearity"><span class="toc-section-number">5.6</span> Collinearity</a></li>
<li><a href="sparse-variables.html#sparse-variables" id="toc-sparse-variables"><span class="toc-section-number">5.7</span> Sparse Variables</a></li>
<li><a href="re-encode-dummy-variables.html#re-encode-dummy-variables" id="toc-re-encode-dummy-variables"><span class="toc-section-number">5.8</span> Re-encode Dummy Variables</a></li>
</ul></li>
<li><a href="datawrangline.html#datawrangline" id="toc-datawrangline"><span class="toc-section-number">6</span> Data Wrangling</a>
<ul>
<li><a href="summarize-data.html#summarize-data" id="toc-summarize-data"><span class="toc-section-number">6.1</span> Summarize Data</a>
<ul>
<li><a href="summarize-data.html#dplyr-package" id="toc-dplyr-package"><span class="toc-section-number">6.1.1</span> <code>dplyr</code> package</a></li>
<li><a href="summarize-data.html#applyfamilyinbaser" id="toc-applyfamilyinbaser"><span class="toc-section-number">6.1.2</span> <code>apply()</code>, <code>lapply()</code> and <code>sapply()</code> in base R</a></li>
</ul></li>
<li><a href="tidy-and-reshape-data.html#tidy-and-reshape-data" id="toc-tidy-and-reshape-data"><span class="toc-section-number">6.2</span> Tidy and Reshape Data</a></li>
</ul></li>
<li><a href="modeltuningstrategy.html#modeltuningstrategy" id="toc-modeltuningstrategy"><span class="toc-section-number">7</span> Model Tuning Strategy</a>
<ul>
<li><a href="vbtradeoff.html#vbtradeoff" id="toc-vbtradeoff"><span class="toc-section-number">7.1</span> Variance-Bias Trade-Off</a></li>
<li><a href="datasplittingresampling.html#datasplittingresampling" id="toc-datasplittingresampling"><span class="toc-section-number">7.2</span> Data Splitting and Resampling</a>
<ul>
<li><a href="datasplittingresampling.html#datasplitting" id="toc-datasplitting"><span class="toc-section-number">7.2.1</span> Data Splitting</a></li>
<li><a href="datasplittingresampling.html#resampling" id="toc-resampling"><span class="toc-section-number">7.2.2</span> Resampling</a></li>
</ul></li>
</ul></li>
<li><a href="measuring-performance.html#measuring-performance" id="toc-measuring-performance"><span class="toc-section-number">8</span> Measuring Performance</a>
<ul>
<li><a href="regression-model-performance.html#regression-model-performance" id="toc-regression-model-performance"><span class="toc-section-number">8.1</span> Regression Model Performance</a></li>
<li><a href="classification-model-performance.html#classification-model-performance" id="toc-classification-model-performance"><span class="toc-section-number">8.2</span> Classification Model Performance</a>
<ul>
<li><a href="classification-model-performance.html#confusion-matrix" id="toc-confusion-matrix"><span class="toc-section-number">8.2.1</span> Confusion Matrix</a></li>
<li><a href="classification-model-performance.html#kappa-statistic" id="toc-kappa-statistic"><span class="toc-section-number">8.2.2</span> Kappa Statistic</a></li>
<li><a href="classification-model-performance.html#roc" id="toc-roc"><span class="toc-section-number">8.2.3</span> ROC</a></li>
<li><a href="classification-model-performance.html#gain-and-lift-charts" id="toc-gain-and-lift-charts"><span class="toc-section-number">8.2.4</span> Gain and Lift Charts</a></li>
</ul></li>
</ul></li>
<li><a href="regression-models.html#regression-models" id="toc-regression-models"><span class="toc-section-number">9</span> Regression Models</a>
<ul>
<li><a href="ordinary-least-square.html#ordinary-least-square" id="toc-ordinary-least-square"><span class="toc-section-number">9.1</span> Ordinary Least Square</a>
<ul>
<li><a href="ordinary-least-square.html#the-magic-p-value" id="toc-the-magic-p-value"><span class="toc-section-number">9.1.1</span> The Magic P-value</a></li>
<li><a href="ordinary-least-square.html#diagnostics-for-linear-regression" id="toc-diagnostics-for-linear-regression"><span class="toc-section-number">9.1.2</span> Diagnostics for Linear Regression</a></li>
</ul></li>
<li><a href="principal-component-regression-and-partial-least-square.html#principal-component-regression-and-partial-least-square" id="toc-principal-component-regression-and-partial-least-square"><span class="toc-section-number">9.2</span> Principal Component Regression and Partial Least Square</a></li>
</ul></li>
<li><a href="regularization-methods.html#regularization-methods" id="toc-regularization-methods"><span class="toc-section-number">10</span> Regularization Methods</a>
<ul>
<li><a href="ridge-regression.html#ridge-regression" id="toc-ridge-regression"><span class="toc-section-number">10.1</span> Ridge Regression</a></li>
<li><a href="lasso.html#lasso" id="toc-lasso"><span class="toc-section-number">10.2</span> LASSO</a></li>
<li><a href="elastic-net.html#elastic-net" id="toc-elastic-net"><span class="toc-section-number">10.3</span> Elastic Net</a></li>
<li><a href="penalized-generalized-linear-model.html#penalized-generalized-linear-model" id="toc-penalized-generalized-linear-model"><span class="toc-section-number">10.4</span> Penalized Generalized Linear Model</a>
<ul>
<li><a href="penalized-generalized-linear-model.html#introduction-to-glmnet-package" id="toc-introduction-to-glmnet-package"><span class="toc-section-number">10.4.1</span> Introduction to <code>glmnet</code> package</a></li>
<li><a href="penalized-generalized-linear-model.html#penalized-logistic-regression" id="toc-penalized-logistic-regression"><span class="toc-section-number">10.4.2</span> Penalized logistic regression</a></li>
</ul></li>
</ul></li>
<li><a href="treemodel.html#treemodel" id="toc-treemodel"><span class="toc-section-number">11</span> Tree-Based Methods</a>
<ul>
<li><a href="tree-basics.html#tree-basics" id="toc-tree-basics"><span class="toc-section-number">11.1</span> Tree Basics</a></li>
<li><a href="splitting-criteria.html#splitting-criteria" id="toc-splitting-criteria"><span class="toc-section-number">11.2</span> Splitting Criteria</a>
<ul>
<li><a href="splitting-criteria.html#gini-impurity" id="toc-gini-impurity"><span class="toc-section-number">11.2.1</span> Gini impurity</a></li>
<li><a href="splitting-criteria.html#information-gain-ig" id="toc-information-gain-ig"><span class="toc-section-number">11.2.2</span> Information Gain (IG)</a></li>
<li><a href="splitting-criteria.html#information-gain-ratio-igr" id="toc-information-gain-ratio-igr"><span class="toc-section-number">11.2.3</span> Information Gain Ratio (IGR)</a></li>
<li><a href="splitting-criteria.html#sum-of-squared-error-sse" id="toc-sum-of-squared-error-sse"><span class="toc-section-number">11.2.4</span> Sum of Squared Error (SSE)</a></li>
</ul></li>
<li><a href="tree-pruning.html#tree-pruning" id="toc-tree-pruning"><span class="toc-section-number">11.3</span> Tree Pruning</a></li>
<li><a href="regression-and-decision-tree-basic.html#regression-and-decision-tree-basic" id="toc-regression-and-decision-tree-basic"><span class="toc-section-number">11.4</span> Regression and Decision Tree Basic</a>
<ul>
<li><a href="regression-and-decision-tree-basic.html#regression-tree" id="toc-regression-tree"><span class="toc-section-number">11.4.1</span> Regression Tree</a></li>
<li><a href="regression-and-decision-tree-basic.html#decision-tree" id="toc-decision-tree"><span class="toc-section-number">11.4.2</span> Decision Tree</a></li>
</ul></li>
<li><a href="bagging-tree-1.html#bagging-tree-1" id="toc-bagging-tree-1"><span class="toc-section-number">11.5</span> Bagging Tree</a></li>
<li><a href="random-forest.html#random-forest" id="toc-random-forest"><span class="toc-section-number">11.6</span> Random Forest</a></li>
<li><a href="gradient-boosted-machine.html#gradient-boosted-machine" id="toc-gradient-boosted-machine"><span class="toc-section-number">11.7</span> Gradient Boosted Machine</a>
<ul>
<li><a href="gradient-boosted-machine.html#adaptive-boosting" id="toc-adaptive-boosting"><span class="toc-section-number">11.7.1</span> Adaptive Boosting</a></li>
<li><a href="gradient-boosted-machine.html#stochastic-gradient-boosting" id="toc-stochastic-gradient-boosting"><span class="toc-section-number">11.7.2</span> Stochastic Gradient Boosting</a></li>
</ul></li>
</ul></li>
<li><a href="deeplearning.html#deeplearning" id="toc-deeplearning"><span class="toc-section-number">12</span> Deep Learning</a>
<ul>
<li><a href="feedforward-neural-network.html#feedforward-neural-network" id="toc-feedforward-neural-network"><span class="toc-section-number">12.1</span> Feedforward Neural Network</a>
<ul>
<li><a href="feedforward-neural-network.html#logisticregasneuralnetwork" id="toc-logisticregasneuralnetwork"><span class="toc-section-number">12.1.1</span> Logistic Regression as Neural Network</a></li>
<li><a href="feedforward-neural-network.html#stochastic-gradient-descent" id="toc-stochastic-gradient-descent"><span class="toc-section-number">12.1.2</span> Stochastic Gradient Descent</a></li>
<li><a href="feedforward-neural-network.html#deepneuralnetwork" id="toc-deepneuralnetwork"><span class="toc-section-number">12.1.3</span> Deep Neural Network</a></li>
<li><a href="feedforward-neural-network.html#activationfunction" id="toc-activationfunction"><span class="toc-section-number">12.1.4</span> Activation Function</a></li>
<li><a href="feedforward-neural-network.html#optimization" id="toc-optimization"><span class="toc-section-number">12.1.5</span> Optimization</a></li>
<li><a href="feedforward-neural-network.html#deal-with-overfitting" id="toc-deal-with-overfitting"><span class="toc-section-number">12.1.6</span> Deal with Overfitting</a></li>
<li><a href="feedforward-neural-network.html#ffnnexample" id="toc-ffnnexample"><span class="toc-section-number">12.1.7</span> Image Recognition Using FFNN</a></li>
</ul></li>
<li><a href="convolutional-neural-network.html#convolutional-neural-network" id="toc-convolutional-neural-network"><span class="toc-section-number">12.2</span> Convolutional Neural Network</a>
<ul>
<li><a href="convolutional-neural-network.html#convolution-layer" id="toc-convolution-layer"><span class="toc-section-number">12.2.1</span> Convolution Layer</a></li>
<li><a href="convolutional-neural-network.html#padding-layer" id="toc-padding-layer"><span class="toc-section-number">12.2.2</span> Padding Layer</a></li>
<li><a href="convolutional-neural-network.html#pooling-layer" id="toc-pooling-layer"><span class="toc-section-number">12.2.3</span> Pooling Layer</a></li>
<li><a href="convolutional-neural-network.html#convolution-over-volume" id="toc-convolution-over-volume"><span class="toc-section-number">12.2.4</span> Convolution Over Volume</a></li>
<li><a href="convolutional-neural-network.html#cnnexample" id="toc-cnnexample"><span class="toc-section-number">12.2.5</span> Image Recognition Using CNN</a></li>
</ul></li>
<li><a href="recurrent-neural-network.html#recurrent-neural-network" id="toc-recurrent-neural-network"><span class="toc-section-number">12.3</span> Recurrent Neural Network</a>
<ul>
<li><a href="recurrent-neural-network.html#rnn-model" id="toc-rnn-model"><span class="toc-section-number">12.3.1</span> RNN Model</a></li>
<li><a href="recurrent-neural-network.html#lstm" id="toc-lstm"><span class="toc-section-number">12.3.2</span> Long Short Term Memory</a></li>
<li><a href="recurrent-neural-network.html#embedding" id="toc-embedding"><span class="toc-section-number">12.3.3</span> Word Embedding</a></li>
<li><a href="recurrent-neural-network.html#rnnexample" id="toc-rnnexample"><span class="toc-section-number">12.3.4</span> Sentiment Analysis Using RNN</a></li>
</ul></li>
</ul></li>
<li><a href="appendix.html#appendix" id="toc-appendix">Appendix</a></li>
<li><a href="largelocaldata.html#largelocaldata" id="toc-largelocaldata"><span class="toc-section-number">13</span> Handling Large Local Data</a>
<ul>
<li><a href="readr.html#readr" id="toc-readr"><span class="toc-section-number">13.1</span> <code>readr</code></a></li>
<li><a href="data.table-enhanced-data.html#data.table-enhanced-data.frame" id="toc-data.table-enhanced-data.frame"><span class="toc-section-number">13.2</span> <code>data.table</code>— enhanced <code>data.frame</code></a></li>
</ul></li>
<li><a href="r-code-for-data-simulation.html#r-code-for-data-simulation" id="toc-r-code-for-data-simulation"><span class="toc-section-number">14</span> R code for data simulation</a>
<ul>
<li><a href="appendixdata1.html#appendixdata1" id="toc-appendixdata1"><span class="toc-section-number">14.1</span> Customer Data for Clothing Company</a></li>
<li><a href="appendixdata3.html#appendixdata3" id="toc-appendixdata3"><span class="toc-section-number">14.2</span> Swine Disease Breakout Data</a></li>
</ul></li>
<li><a href="references.html#references" id="toc-references">References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practitioner’s Guide to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data.table-enhanced-data.frame" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> <code>data.table</code>— enhanced <code>data.frame</code><a href="data.table-enhanced-data.html#data.table-enhanced-data.frame" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What is <code>data.table</code>? It is an R package that provides an enhanced version of <code>data.frame</code>. The most used object in R is <code>data frame</code>. Before we move on, let’s briefly review some basic characters and manipulations of data.frame:</p>
<ul>
<li>It is a set of rows and columns.</li>
<li>Each row is of the same length and data type</li>
<li>Every column is of the same length but can be of differing data types</li>
<li>It has characteristics of both a matrix and a list</li>
<li>It uses <code>[]</code> to subset data</li>
</ul>
<p>We will use the clothes customer data to illustrate. There are two dimensions in <code>[]</code>. The first one indicates the row and second one indicates column. It uses a comma to separate them.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="data.table-enhanced-data.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb432-2"><a href="data.table-enhanced-data.html#cb432-2" aria-hidden="true" tabindex="-1"></a>sim.dat <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;http://bit.ly/2P5gTw4&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 1000 Columns: 19
## ── Column specification ───────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (3): gender, house, segment
## dbl (16): age, income, store_exp, online_exp, store...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="data.table-enhanced-data.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the first two rows</span></span>
<span id="cb434-2"><a href="data.table-enhanced-data.html#cb434-2" aria-hidden="true" tabindex="-1"></a>sim.dat[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ]</span>
<span id="cb434-3"><a href="data.table-enhanced-data.html#cb434-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset the first two rows and column 3 and 5</span></span>
<span id="cb434-4"><a href="data.table-enhanced-data.html#cb434-4" aria-hidden="true" tabindex="-1"></a>sim.dat[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>)]</span>
<span id="cb434-5"><a href="data.table-enhanced-data.html#cb434-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get all rows with age&gt;70</span></span>
<span id="cb434-6"><a href="data.table-enhanced-data.html#cb434-6" aria-hidden="true" tabindex="-1"></a>sim.dat[sim.dat<span class="sc">$</span>age <span class="sc">&gt;</span> <span class="dv">70</span>, ]</span>
<span id="cb434-7"><a href="data.table-enhanced-data.html#cb434-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get rows with age&gt; 60 and gender is Male select column 3 and 4</span></span>
<span id="cb434-8"><a href="data.table-enhanced-data.html#cb434-8" aria-hidden="true" tabindex="-1"></a>sim.dat[sim.dat<span class="sc">$</span>age <span class="sc">&gt;</span> <span class="dv">68</span> <span class="sc">&amp;</span> sim.dat<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>]</span></code></pre></div>
<p>Remember that there are usually different ways to conduct the same manipulation. For example, the following code presents three ways to calculate an average number of online transactions for male and female:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="data.table-enhanced-data.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(sim.dat<span class="sc">$</span>online_trans, sim.dat<span class="sc">$</span>gender, mean)</span>
<span id="cb435-2"><a href="data.table-enhanced-data.html#cb435-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-3"><a href="data.table-enhanced-data.html#cb435-3" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(online_trans <span class="sc">~</span> gender, <span class="at">data =</span> sim.dat, mean)</span>
<span id="cb435-4"><a href="data.table-enhanced-data.html#cb435-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-5"><a href="data.table-enhanced-data.html#cb435-5" aria-hidden="true" tabindex="-1"></a>sim.dat <span class="sc">%&gt;%</span> </span>
<span id="cb435-6"><a href="data.table-enhanced-data.html#cb435-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender) <span class="sc">%&gt;%</span> </span>
<span id="cb435-7"><a href="data.table-enhanced-data.html#cb435-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg_online_trans =</span> <span class="fu">mean</span>(online_trans))</span></code></pre></div>
<p>There is no gold standard to choose a specific function to manipulate data. The goal is to solve the real problem, not the tool itself. So just use whatever tool that is convenient for you.</p>
<p>The way to use <code>[]</code> is straightforward. But the manipulations are limited. If you need more complicated data reshaping or aggregation, there are other packages to use such as <code>dplyr</code>, <code>reshape2</code>, <code>tidyr</code> etc. But the usage of those packages are not as straightforward as <code>[]</code>. You often need to change functions. Keeping related operations together, such as subset, group, update, join etc, will allow for:</p>
<ul>
<li>concise, consistent and readable syntax irrespective of the set of operations you would like to perform to achieve your end goal</li>
<li>performing data manipulation fluidly without the cognitive burden of having to change among different functions</li>
<li>by knowing precisely the data required for each operation, you can automatically optimize operations effectively</li>
</ul>
<p><code>data.table</code> is the package for that. If you are not familiar with other data manipulating packages and are interested in reducing programming time tremendously, then this package is for you.</p>
<p>Other than extending the function of <code>[]</code>, <code>data.table</code> has the following advantages:</p>
<ul>
<li>Offers fast import, subset, grouping, update, and joins for large data files</li>
<li>It is easy to turn data frame to data table</li>
<li>Can behave just like a data frame</li>
</ul>
<p>You need to install and load the package:</p>
<p>Use <code>data.table()</code> to convert the existing data frame <code>sim.dat</code> to data table:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="data.table-enhanced-data.html#cb436-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(sim.dat)</span>
<span id="cb436-2"><a href="data.table-enhanced-data.html#cb436-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dt)</span></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>Calculate mean for counts of online transactions:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="data.table-enhanced-data.html#cb438-1" aria-hidden="true" tabindex="-1"></a>dt[, <span class="fu">mean</span>(online_trans)]</span></code></pre></div>
<pre><code>## [1] 13.55</code></pre>
<p>You can’t do the same thing using data frame:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="data.table-enhanced-data.html#cb440-1" aria-hidden="true" tabindex="-1"></a>sim.dat[,<span class="fu">mean</span>(online_trans)]</span></code></pre></div>
<div class="sourceCode" id="cb441"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb441-1"><a href="data.table-enhanced-data.html#cb441-1" aria-hidden="true" tabindex="-1"></a>Error in mean(online_trans) : object &#39;online_trans&#39; not found</span></code></pre></div>
<p>If you want to calculate mean by group as before, set “<code>by =</code>” argument:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="data.table-enhanced-data.html#cb442-1" aria-hidden="true" tabindex="-1"></a>dt[ , <span class="fu">mean</span>(online_trans), by <span class="ot">=</span> gender]</span></code></pre></div>
<pre><code>##    gender    V1
## 1: Female 15.38
## 2:   Male 11.26</code></pre>
<p>You can group by more than one variables. For example, group by “<code>gender</code>” and “<code>house</code>”:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="data.table-enhanced-data.html#cb444-1" aria-hidden="true" tabindex="-1"></a>dt[ , <span class="fu">mean</span>(online_trans), by <span class="ot">=</span> .(gender, house)]</span></code></pre></div>
<pre><code>##    gender house     V1
## 1: Female   Yes 11.312
## 2:   Male   Yes  8.772
## 3: Female    No 19.146
## 4:   Male    No 16.486</code></pre>
<p>Assign column names for aggregated variables:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="data.table-enhanced-data.html#cb446-1" aria-hidden="true" tabindex="-1"></a>dt[ , .(<span class="at">avg =</span> <span class="fu">mean</span>(online_trans)), by <span class="ot">=</span> .(gender, house)]</span></code></pre></div>
<pre><code>##    gender house    avg
## 1: Female   Yes 11.312
## 2:   Male   Yes  8.772
## 3: Female    No 19.146
## 4:   Male    No 16.486</code></pre>
<p><code>data.table</code> can accomplish all operations that <code>aggregate()</code> and <code>tapply()</code>can do for data frame.</p>
<ul>
<li>General setting of <code>data.table</code></li>
</ul>
<p>Different from data frame, there are three arguments for data table:</p>
<center>
<img src="images/datable1.png" />
</center>
<p>It is analogous to SQL. You don’t have to know SQL to learn data table. But experience with SQL will help you understand data table. In SQL, you select column <code>j</code> (use command <code>SELECT</code>) for row <code>i</code> (using command <code>WHERE</code>). <code>GROUP BY</code> in SQL will assign the variable to group the observations.</p>
<center>
<img src="images/rSQL.png" />
</center>
<p>Let’s review our previous code:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="data.table-enhanced-data.html#cb448-1" aria-hidden="true" tabindex="-1"></a>dt[ , <span class="fu">mean</span>(online_trans), by <span class="ot">=</span> gender]</span></code></pre></div>
<p>The code above is equal to the following SQL:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb449-1"><a href="data.table-enhanced-data.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb449-2"><a href="data.table-enhanced-data.html#cb449-2" aria-hidden="true" tabindex="-1"></a>   gender,</span>
<span id="cb449-3"><a href="data.table-enhanced-data.html#cb449-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">avg</span>(online_trans) </span>
<span id="cb449-4"><a href="data.table-enhanced-data.html#cb449-4" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb449-5"><a href="data.table-enhanced-data.html#cb449-5" aria-hidden="true" tabindex="-1"></a>   sim.dat </span>
<span id="cb449-6"><a href="data.table-enhanced-data.html#cb449-6" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb449-7"><a href="data.table-enhanced-data.html#cb449-7" aria-hidden="true" tabindex="-1"></a>   gender</span></code></pre></div>
<p>R code:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="data.table-enhanced-data.html#cb450-1" aria-hidden="true" tabindex="-1"></a>dt[ , .(<span class="at">avg =</span> <span class="fu">mean</span>(online_trans)), by <span class="ot">=</span> .(gender, house)]</span></code></pre></div>
<p>is equal to SQL:</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb451-1"><a href="data.table-enhanced-data.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb451-2"><a href="data.table-enhanced-data.html#cb451-2" aria-hidden="true" tabindex="-1"></a>   gender,</span>
<span id="cb451-3"><a href="data.table-enhanced-data.html#cb451-3" aria-hidden="true" tabindex="-1"></a>   house,</span>
<span id="cb451-4"><a href="data.table-enhanced-data.html#cb451-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">avg</span>(online_trans) <span class="kw">AS</span> <span class="fu">avg</span> </span>
<span id="cb451-5"><a href="data.table-enhanced-data.html#cb451-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb451-6"><a href="data.table-enhanced-data.html#cb451-6" aria-hidden="true" tabindex="-1"></a>   sim.dat </span>
<span id="cb451-7"><a href="data.table-enhanced-data.html#cb451-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb451-8"><a href="data.table-enhanced-data.html#cb451-8" aria-hidden="true" tabindex="-1"></a>   gender,</span>
<span id="cb451-9"><a href="data.table-enhanced-data.html#cb451-9" aria-hidden="true" tabindex="-1"></a>   house</span></code></pre></div>
<p>R code:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="data.table-enhanced-data.html#cb452-1" aria-hidden="true" tabindex="-1"></a>dt[ age <span class="sc">&lt;</span> <span class="dv">40</span>, .(<span class="at">avg =</span> <span class="fu">mean</span>(online_trans)), by <span class="ot">=</span> .(gender, house)]</span></code></pre></div>
<p>is equal to SQL:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb453-1"><a href="data.table-enhanced-data.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb453-2"><a href="data.table-enhanced-data.html#cb453-2" aria-hidden="true" tabindex="-1"></a>   gender,</span>
<span id="cb453-3"><a href="data.table-enhanced-data.html#cb453-3" aria-hidden="true" tabindex="-1"></a>   house,</span>
<span id="cb453-4"><a href="data.table-enhanced-data.html#cb453-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">avg</span>(online_trans) <span class="kw">AS</span> <span class="fu">avg</span> </span>
<span id="cb453-5"><a href="data.table-enhanced-data.html#cb453-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb453-6"><a href="data.table-enhanced-data.html#cb453-6" aria-hidden="true" tabindex="-1"></a>   sim.dat </span>
<span id="cb453-7"><a href="data.table-enhanced-data.html#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb453-8"><a href="data.table-enhanced-data.html#cb453-8" aria-hidden="true" tabindex="-1"></a>   age <span class="op">&lt;</span> <span class="dv">40</span> </span>
<span id="cb453-9"><a href="data.table-enhanced-data.html#cb453-9" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb453-10"><a href="data.table-enhanced-data.html#cb453-10" aria-hidden="true" tabindex="-1"></a>   gender,</span>
<span id="cb453-11"><a href="data.table-enhanced-data.html#cb453-11" aria-hidden="true" tabindex="-1"></a>   house</span></code></pre></div>
<p>You can see the analogy between <code>data.table</code> and <code>SQL</code>. Now let’s focus on operations in data table.</p>
<ul>
<li>select row</li>
</ul>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="data.table-enhanced-data.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select rows with age&lt;20 and income &gt; 80000</span></span>
<span id="cb454-2"><a href="data.table-enhanced-data.html#cb454-2" aria-hidden="true" tabindex="-1"></a>dt[age <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">&amp;</span> income <span class="sc">&gt;</span> <span class="dv">80000</span>]</span></code></pre></div>
<pre><code>##    age gender income house store_exp online_exp
## 1:  19 Female  83535    No     227.7       1491
## 2:  18 Female  89416   Yes     209.5       1926
## 3:  19 Female  92813    No     186.7       1042
##    store_trans online_trans Q1 Q2 Q3 Q4 Q5 Q6 Q7 Q8 Q9
## 1:           1           22  2  1  1  2  4  1  4  2  4
## 2:           3           28  2  1  1  1  4  1  4  2  4
## 3:           2           18  3  1  1  2  4  1  4  3  4
##    Q10 segment
## 1:   1   Style
## 2:   1   Style
## 3:   1   Style</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="data.table-enhanced-data.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the first two rows</span></span>
<span id="cb456-2"><a href="data.table-enhanced-data.html#cb456-2" aria-hidden="true" tabindex="-1"></a>dt[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>##    age gender income house store_exp online_exp
## 1:  57 Female 120963   Yes     529.1      303.5
## 2:  63 Female 122008   Yes     478.0      109.5
##    store_trans online_trans Q1 Q2 Q3 Q4 Q5 Q6 Q7 Q8 Q9
## 1:           2            2  4  2  1  2  1  4  1  4  2
## 2:           4            2  4  1  1  2  1  4  1  4  1
##    Q10 segment
## 1:   4   Price
## 2:   4   Price</code></pre>
<ul>
<li>select column</li>
</ul>
<p>Selecting columns in <code>data.table</code> don’t need <code>$</code>:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="data.table-enhanced-data.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select column “age” but return it as a vector</span></span>
<span id="cb458-2"><a href="data.table-enhanced-data.html#cb458-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the argument for row is empty so the result</span></span>
<span id="cb458-3"><a href="data.table-enhanced-data.html#cb458-3" aria-hidden="true" tabindex="-1"></a><span class="co"># will return all observations</span></span>
<span id="cb458-4"><a href="data.table-enhanced-data.html#cb458-4" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> dt[, age]</span>
<span id="cb458-5"><a href="data.table-enhanced-data.html#cb458-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ans)</span></code></pre></div>
<pre><code>## [1] 57 63 59 60 51 59</code></pre>
<p>To return <code>data.table</code> object, put column names in <code>list()</code>:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="data.table-enhanced-data.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select age and online_exp columns </span></span>
<span id="cb460-2"><a href="data.table-enhanced-data.html#cb460-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and return as a data.table instead</span></span>
<span id="cb460-3"><a href="data.table-enhanced-data.html#cb460-3" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> dt[, <span class="fu">list</span>(age, online_exp)]</span>
<span id="cb460-4"><a href="data.table-enhanced-data.html#cb460-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ans)</span></code></pre></div>
<p>Or you can also put column names in <code>.()</code>:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="data.table-enhanced-data.html#cb461-1" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> dt[, .(age, online_exp)]</span></code></pre></div>
<p>To select all columns from “<code>age</code>” to “<code>income</code>”:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="data.table-enhanced-data.html#cb462-1" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> dt[, age<span class="sc">:</span>income, with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb462-2"><a href="data.table-enhanced-data.html#cb462-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ans,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##    age gender income
## 1:  57 Female 120963
## 2:  63 Female 122008</code></pre>
<p>Delete columns using <code>-</code> or <code>!</code>:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="data.table-enhanced-data.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="co"># delete columns from  age to online_exp</span></span>
<span id="cb464-2"><a href="data.table-enhanced-data.html#cb464-2" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> dt[, <span class="sc">-</span>(age<span class="sc">:</span>online_exp), with <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb464-3"><a href="data.table-enhanced-data.html#cb464-3" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> dt[, <span class="sc">!</span>(age<span class="sc">:</span>online_exp), with <span class="ot">=</span> <span class="cn">FALSE</span>]</span></code></pre></div>
<ul>
<li>tabulation</li>
</ul>
<p>In data table. <code>.N</code> means to count。</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="data.table-enhanced-data.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co"># row count</span></span>
<span id="cb465-2"><a href="data.table-enhanced-data.html#cb465-2" aria-hidden="true" tabindex="-1"></a>dt[, .N] </span></code></pre></div>
<pre><code>## [1] 1000</code></pre>
<p>If you assign the group variable, then it will count by groups:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="data.table-enhanced-data.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="co"># counts by gender</span></span>
<span id="cb467-2"><a href="data.table-enhanced-data.html#cb467-2" aria-hidden="true" tabindex="-1"></a>dt[, .N, by<span class="ot">=</span> gender]  </span></code></pre></div>
<pre><code>##    gender   N
## 1: Female 554
## 2:   Male 446</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="data.table-enhanced-data.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for those younger than 30, count by gender</span></span>
<span id="cb469-2"><a href="data.table-enhanced-data.html#cb469-2" aria-hidden="true" tabindex="-1"></a> dt[age <span class="sc">&lt;</span> <span class="dv">30</span>, .(<span class="at">count=</span>.N), by<span class="ot">=</span> gender] </span></code></pre></div>
<pre><code>##    gender count
## 1: Female   292
## 2:   Male    86</code></pre>
<p>Order table:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="data.table-enhanced-data.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get records with the highest 5 online expense:</span></span>
<span id="cb471-2"><a href="data.table-enhanced-data.html#cb471-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt[<span class="fu">order</span>(<span class="sc">-</span>online_exp)],<span class="dv">5</span>) </span></code></pre></div>
<pre class="pre"><code>   age gender   income house store_exp online_exp store_trans ...
1:  40 Female 217599.7    No  7023.684   9479.442          10
2:  41 Female       NA   Yes  3786.740   8638.239          14
3:  36   Male 228550.1   Yes  3279.621   8220.555           8
4:  31 Female 159508.1   Yes  5177.081   8005.932          11
5:  43 Female 190407.4   Yes  4694.922   7875.562           6
...</code></pre>
<p>Since data table keep some characters of data frame, they share some operations:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="data.table-enhanced-data.html#cb473-1" aria-hidden="true" tabindex="-1"></a>dt[<span class="fu">order</span>(<span class="sc">-</span>online_exp)][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<p>You can also order the table by more than one variable. The following code will order the table by <code>gender</code>, then order within <code>gender</code> by <code>online_exp</code>:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="data.table-enhanced-data.html#cb474-1" aria-hidden="true" tabindex="-1"></a>dt[<span class="fu">order</span>(gender, <span class="sc">-</span>online_exp)][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<ul>
<li>Use <code>fread()</code> to import dat</li>
</ul>
<p>Other than <code>read.csv</code> in base R, we have introduced ‘read_csv’ in ‘readr’. <code>read_csv</code> is much faster and will provide progress bar which makes user feel much better (at least make me feel better). <code>fread()</code> in <code>data.table</code> further increase the efficiency of reading data. The following are three examples of reading the same data file <code>topic.csv</code>. The file includes text data scraped from an agriculture forum with 209670 rows and 6 columns:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="data.table-enhanced-data.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(topic <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;http://bit.ly/2zam5ny&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb476"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb476-1"><a href="data.table-enhanced-data.html#cb476-1" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb476-2"><a href="data.table-enhanced-data.html#cb476-2" aria-hidden="true" tabindex="-1"></a>  3.561   0.051   4.888 </span></code></pre></div>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="data.table-enhanced-data.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(topic <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&quot;http://bit.ly/2zam5ny&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb478"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb478-1"><a href="data.table-enhanced-data.html#cb478-1" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb478-2"><a href="data.table-enhanced-data.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  0.409   0.032   2.233 </span></code></pre></div>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="data.table-enhanced-data.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(topic <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;http://bit.ly/2zam5ny&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb480"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb480-1"><a href="data.table-enhanced-data.html#cb480-1" aria-hidden="true" tabindex="-1"></a>   user  system elapsed </span>
<span id="cb480-2"><a href="data.table-enhanced-data.html#cb480-2" aria-hidden="true" tabindex="-1"></a>  0.276   0.096   1.117 </span></code></pre></div>
<p>It is clear that <code>read_csv()</code> is much faster than <code>read.csv()</code>. <code>fread()</code> is a little faster than <code>read_csv()</code>. As the size increasing, the difference will become for significant. Note that <code>fread()</code> will read file as <code>data.table</code> by default.</p>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="readr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-code-for-data-simulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/happyrabbit/IntroDataScience/19-Appendix.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["IDS.pdf", "IDS.epub", "IDS.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
