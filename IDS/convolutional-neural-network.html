<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12.4 Convolutional Neural Network | Introduction to Data Science</title>
  <meta name="description" content="12.4 Convolutional Neural Network | Introduction to Data Science" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="12.4 Convolutional Neural Network | Introduction to Data Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://scientistcafe.com/IDS/" />
  
  <meta property="og:description" content="12.4 Convolutional Neural Network | Introduction to Data Science" />
  <meta name="github-repo" content="happyrabbit/IntroDataScience" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12.4 Convolutional Neural Network | Introduction to Data Science" />
  
  <meta name="twitter:description" content="12.4 Convolutional Neural Network | Introduction to Data Science" />
  

<meta name="author" content="Hui Lin and Ming Li" />


<meta name="date" content="2020-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="feedforward-neural-network.html"/>
<link rel="next" href="recurrent-neural-network.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://scientistcafe.com">Homepage</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="goal-of-the-book.html"><a href="goal-of-the-book.html"><i class="fa fa-check"></i>Goal of the Book</a></li>
<li class="chapter" data-level="" data-path="who-this-book-is-for.html"><a href="who-this-book-is-for.html"><i class="fa fa-check"></i>Who This Book Is For</a></li>
<li class="chapter" data-level="" data-path="what-this-book-covers.html"><a href="what-this-book-covers.html"><i class="fa fa-check"></i>What This Book Covers</a></li>
<li class="chapter" data-level="" data-path="conventions.html"><a href="conventions.html"><i class="fa fa-check"></i>Conventions</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="blind-men-and-an-elephant.html"><a href="blind-men-and-an-elephant.html"><i class="fa fa-check"></i><b>1.1</b> Blind men and an elephant</a><ul>
<li class="chapter" data-level="1.1.1" data-path="blind-men-and-an-elephant.html"><a href="blind-men-and-an-elephant.html#data-science-roleskill-tracks"><i class="fa fa-check"></i><b>1.1.1</b> Data science role/skill tracks</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="what-should-data-science-do.html"><a href="what-should-data-science-do.html"><i class="fa fa-check"></i><b>1.2</b> What should data science do?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="what-should-data-science-do.html"><a href="what-should-data-science-do.html#lets-dream-big"><i class="fa fa-check"></i><b>1.2.1</b> Let’s dream big</a></li>
<li class="chapter" data-level="1.2.2" data-path="what-should-data-science-do.html"><a href="what-should-data-science-do.html#what-kind-of-questions-can-data-science-solve"><i class="fa fa-check"></i><b>1.2.2</b> What kind of questions can data science solve?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="structure-data-science-team.html"><a href="structure-data-science-team.html"><i class="fa fa-check"></i><b>1.3</b> Structure data science team</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="soft-skills-for-data-scientists.html"><a href="soft-skills-for-data-scientists.html"><i class="fa fa-check"></i><b>2</b> Soft Skills for Data Scientists</a><ul>
<li class="chapter" data-level="2.1" data-path="comparison-between-statistician-and-data-scientist.html"><a href="comparison-between-statistician-and-data-scientist.html"><i class="fa fa-check"></i><b>2.1</b> Comparison between Statistician and Data Scientist</a></li>
<li class="chapter" data-level="2.2" data-path="beyond-data-and-analytics.html"><a href="beyond-data-and-analytics.html"><i class="fa fa-check"></i><b>2.2</b> Beyond Data and Analytics</a></li>
<li class="chapter" data-level="2.3" data-path="three-pillars-of-knowledge.html"><a href="three-pillars-of-knowledge.html"><i class="fa fa-check"></i><b>2.3</b> Three Pillars of Knowledge</a></li>
<li class="chapter" data-level="2.4" data-path="data-science-project-cycle.html"><a href="data-science-project-cycle.html"><i class="fa fa-check"></i><b>2.4</b> Data Science Project Cycle</a><ul>
<li class="chapter" data-level="2.4.1" data-path="data-science-project-cycle.html"><a href="data-science-project-cycle.html#types-of-data-science-projects"><i class="fa fa-check"></i><b>2.4.1</b> Types of Data Science Projects</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-science-project-cycle.html"><a href="data-science-project-cycle.html#at-the-planning-stage"><i class="fa fa-check"></i><b>2.4.2</b> At the Planning Stage</a></li>
<li class="chapter" data-level="2.4.3" data-path="data-science-project-cycle.html"><a href="data-science-project-cycle.html#at-the-modeling-stage"><i class="fa fa-check"></i><b>2.4.3</b> At the Modeling Stage</a></li>
<li class="chapter" data-level="2.4.4" data-path="data-science-project-cycle.html"><a href="data-science-project-cycle.html#at-the-production-stage"><i class="fa fa-check"></i><b>2.4.4</b> At the Production Stage</a></li>
<li class="chapter" data-level="2.4.5" data-path="data-science-project-cycle.html"><a href="data-science-project-cycle.html#summary"><i class="fa fa-check"></i><b>2.4.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="common-mistakes-in-data-science.html"><a href="common-mistakes-in-data-science.html"><i class="fa fa-check"></i><b>2.5</b> Common Mistakes in Data Science</a><ul>
<li class="chapter" data-level="2.5.1" data-path="common-mistakes-in-data-science.html"><a href="common-mistakes-in-data-science.html#problem-formulation-stage"><i class="fa fa-check"></i><b>2.5.1</b> Problem Formulation Stage</a></li>
<li class="chapter" data-level="2.5.2" data-path="common-mistakes-in-data-science.html"><a href="common-mistakes-in-data-science.html#problem-planning-stage"><i class="fa fa-check"></i><b>2.5.2</b> Problem Planning Stage</a></li>
<li class="chapter" data-level="2.5.3" data-path="common-mistakes-in-data-science.html"><a href="common-mistakes-in-data-science.html#modeling-stage"><i class="fa fa-check"></i><b>2.5.3</b> Modeling Stage</a></li>
<li class="chapter" data-level="2.5.4" data-path="common-mistakes-in-data-science.html"><a href="common-mistakes-in-data-science.html#production-stage"><i class="fa fa-check"></i><b>2.5.4</b> Production Stage</a></li>
<li class="chapter" data-level="2.5.5" data-path="common-mistakes-in-data-science.html"><a href="common-mistakes-in-data-science.html#summary-1"><i class="fa fa-check"></i><b>2.5.5</b> Summary</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-the-data.html"><a href="introduction-to-the-data.html"><i class="fa fa-check"></i><b>3</b> Introduction to The Data</a><ul>
<li class="chapter" data-level="3.1" data-path="customer-data-for-a-clothing-company.html"><a href="customer-data-for-a-clothing-company.html"><i class="fa fa-check"></i><b>3.1</b> Customer Data for A Clothing Company</a></li>
<li class="chapter" data-level="3.2" data-path="customer-satisfaction-survey-data-from-airline-company.html"><a href="customer-satisfaction-survey-data-from-airline-company.html"><i class="fa fa-check"></i><b>3.2</b> Customer Satisfaction Survey Data from Airline Company</a></li>
<li class="chapter" data-level="3.3" data-path="swinediseasedata.html"><a href="swinediseasedata.html"><i class="fa fa-check"></i><b>3.3</b> Swine Disease Breakout Data</a></li>
<li class="chapter" data-level="3.4" data-path="mnist-dataset.html"><a href="mnist-dataset.html"><i class="fa fa-check"></i><b>3.4</b> MNIST Dataset</a></li>
<li class="chapter" data-level="3.5" data-path="imdb-dataset.html"><a href="imdb-dataset.html"><i class="fa fa-check"></i><b>3.5</b> IMDB Dataset</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="big-data-cloud-platform.html"><a href="big-data-cloud-platform.html"><i class="fa fa-check"></i><b>4</b> Big Data Cloud Platform</a><ul>
<li class="chapter" data-level="4.1" data-path="power-of-cluster-of-computers.html"><a href="power-of-cluster-of-computers.html"><i class="fa fa-check"></i><b>4.1</b> Power of Cluster of Computers</a></li>
<li class="chapter" data-level="4.2" data-path="evolution-of-cluster-computing.html"><a href="evolution-of-cluster-computing.html"><i class="fa fa-check"></i><b>4.2</b> Evolution of Cluster Computing</a><ul>
<li class="chapter" data-level="4.2.1" data-path="evolution-of-cluster-computing.html"><a href="evolution-of-cluster-computing.html#hadoop"><i class="fa fa-check"></i><b>4.2.1</b> Hadoop</a></li>
<li class="chapter" data-level="4.2.2" data-path="evolution-of-cluster-computing.html"><a href="evolution-of-cluster-computing.html#spark"><i class="fa fa-check"></i><b>4.2.2</b> Spark</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="CloudEnvironment.html"><a href="CloudEnvironment.html"><i class="fa fa-check"></i><b>4.3</b> Introduction of Cloud Environment</a><ul>
<li class="chapter" data-level="4.3.1" data-path="CloudEnvironment.html"><a href="CloudEnvironment.html#open-account-and-create-a-cluster"><i class="fa fa-check"></i><b>4.3.1</b> Open Account and Create a Cluster</a></li>
<li class="chapter" data-level="4.3.2" data-path="CloudEnvironment.html"><a href="CloudEnvironment.html#r-notebook"><i class="fa fa-check"></i><b>4.3.2</b> R Notebook</a></li>
<li class="chapter" data-level="4.3.3" data-path="CloudEnvironment.html"><a href="CloudEnvironment.html#markdown-cells"><i class="fa fa-check"></i><b>4.3.3</b> Markdown Cells</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="leverage-spark-using-r-notebook.html"><a href="leverage-spark-using-r-notebook.html"><i class="fa fa-check"></i><b>4.4</b> Leverage Spark Using R Notebook</a></li>
<li class="chapter" data-level="4.5" data-path="databases-and-sql.html"><a href="databases-and-sql.html"><i class="fa fa-check"></i><b>4.5</b> Databases and SQL</a><ul>
<li class="chapter" data-level="4.5.1" data-path="databases-and-sql.html"><a href="databases-and-sql.html#history"><i class="fa fa-check"></i><b>4.5.1</b> History</a></li>
<li class="chapter" data-level="4.5.2" data-path="databases-and-sql.html"><a href="databases-and-sql.html#database-table-and-view"><i class="fa fa-check"></i><b>4.5.2</b> Database, Table and View</a></li>
<li class="chapter" data-level="4.5.3" data-path="databases-and-sql.html"><a href="databases-and-sql.html#basic-sql-statement"><i class="fa fa-check"></i><b>4.5.3</b> Basic SQL Statement</a></li>
<li class="chapter" data-level="4.5.4" data-path="databases-and-sql.html"><a href="databases-and-sql.html#advanced-topics-in-database"><i class="fa fa-check"></i><b>4.5.4</b> Advanced Topics in Database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-pre-processing.html"><a href="data-pre-processing.html"><i class="fa fa-check"></i><b>5</b> Data Pre-processing</a><ul>
<li class="chapter" data-level="5.1" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>5.1</b> Data Cleaning</a></li>
<li class="chapter" data-level="5.2" data-path="missing-values.html"><a href="missing-values.html"><i class="fa fa-check"></i><b>5.2</b> Missing Values</a><ul>
<li class="chapter" data-level="5.2.1" data-path="missing-values.html"><a href="missing-values.html#impute-missing-values-with-medianmode"><i class="fa fa-check"></i><b>5.2.1</b> Impute missing values with median/mode</a></li>
<li class="chapter" data-level="5.2.2" data-path="missing-values.html"><a href="missing-values.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>5.2.2</b> K-nearest neighbors</a></li>
<li class="chapter" data-level="5.2.3" data-path="missing-values.html"><a href="missing-values.html#bagging-tree"><i class="fa fa-check"></i><b>5.2.3</b> Bagging Tree</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="centering-and-scaling.html"><a href="centering-and-scaling.html"><i class="fa fa-check"></i><b>5.3</b> Centering and Scaling</a></li>
<li class="chapter" data-level="5.4" data-path="resolve-skewness.html"><a href="resolve-skewness.html"><i class="fa fa-check"></i><b>5.4</b> Resolve Skewness</a></li>
<li class="chapter" data-level="5.5" data-path="resolve-outliers.html"><a href="resolve-outliers.html"><i class="fa fa-check"></i><b>5.5</b> Resolve Outliers</a></li>
<li class="chapter" data-level="5.6" data-path="collinearity.html"><a href="collinearity.html"><i class="fa fa-check"></i><b>5.6</b> Collinearity</a></li>
<li class="chapter" data-level="5.7" data-path="sparse-variables.html"><a href="sparse-variables.html"><i class="fa fa-check"></i><b>5.7</b> Sparse Variables</a></li>
<li class="chapter" data-level="5.8" data-path="re-encode-dummy-variables.html"><a href="re-encode-dummy-variables.html"><i class="fa fa-check"></i><b>5.8</b> Re-encode Dummy Variables</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>6</b> Data Wrangling</a><ul>
<li class="chapter" data-level="6.1" data-path="read-and-write-data.html"><a href="read-and-write-data.html"><i class="fa fa-check"></i><b>6.1</b> Read and write data</a><ul>
<li class="chapter" data-level="6.1.1" data-path="read-and-write-data.html"><a href="read-and-write-data.html#readr"><i class="fa fa-check"></i><b>6.1.1</b> <code>readr</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="read-and-write-data.html"><a href="read-and-write-data.html#data.table-enhanced-data.frame"><i class="fa fa-check"></i><b>6.1.2</b> <code>data.table</code>— enhanced <code>data.frame</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="summarize-data.html"><a href="summarize-data.html"><i class="fa fa-check"></i><b>6.2</b> Summarize data</a><ul>
<li class="chapter" data-level="6.2.1" data-path="summarize-data.html"><a href="summarize-data.html#apply-lapply-and-sapply-in-base-r"><i class="fa fa-check"></i><b>6.2.1</b> <code>apply()</code>, <code>lapply()</code> and <code>sapply()</code> in base R</a></li>
<li class="chapter" data-level="6.2.2" data-path="summarize-data.html"><a href="summarize-data.html#dplyr-package"><i class="fa fa-check"></i><b>6.2.2</b> <code>dplyr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="tidy-and-reshape-data.html"><a href="tidy-and-reshape-data.html"><i class="fa fa-check"></i><b>6.3</b> Tidy and Reshape Data</a><ul>
<li class="chapter" data-level="6.3.1" data-path="tidy-and-reshape-data.html"><a href="tidy-and-reshape-data.html#reshape2-package"><i class="fa fa-check"></i><b>6.3.1</b> <code>reshape2</code> package</a></li>
<li class="chapter" data-level="6.3.2" data-path="tidy-and-reshape-data.html"><a href="tidy-and-reshape-data.html#tidyr-package"><i class="fa fa-check"></i><b>6.3.2</b> <code>tidyr</code> package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modeltuningstrategy.html"><a href="modeltuningstrategy.html"><i class="fa fa-check"></i><b>7</b> Model Tuning Strategy</a><ul>
<li class="chapter" data-level="7.1" data-path="systematic-error-and-random-error.html"><a href="systematic-error-and-random-error.html"><i class="fa fa-check"></i><b>7.1</b> Systematic Error and Random Error</a><ul>
<li class="chapter" data-level="7.1.1" data-path="systematic-error-and-random-error.html"><a href="systematic-error-and-random-error.html#vbtradeoff"><i class="fa fa-check"></i><b>7.1.1</b> Variance-Bias Trade-Off</a></li>
<li class="chapter" data-level="7.1.2" data-path="systematic-error-and-random-error.html"><a href="systematic-error-and-random-error.html#measurement-error-in-the-response"><i class="fa fa-check"></i><b>7.1.2</b> Measurement Error in the Response</a></li>
<li class="chapter" data-level="7.1.3" data-path="systematic-error-and-random-error.html"><a href="systematic-error-and-random-error.html#measurement-error-in-the-independent-variables"><i class="fa fa-check"></i><b>7.1.3</b> Measurement Error in the Independent Variables</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data-splitting-and-resampling.html"><a href="data-splitting-and-resampling.html"><i class="fa fa-check"></i><b>7.2</b> Data Splitting and Resampling</a><ul>
<li class="chapter" data-level="7.2.1" data-path="data-splitting-and-resampling.html"><a href="data-splitting-and-resampling.html#data-splitting"><i class="fa fa-check"></i><b>7.2.1</b> Data Splitting</a></li>
<li class="chapter" data-level="7.2.2" data-path="data-splitting-and-resampling.html"><a href="data-splitting-and-resampling.html#resampling"><i class="fa fa-check"></i><b>7.2.2</b> Resampling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="measuring-performance.html"><a href="measuring-performance.html"><i class="fa fa-check"></i><b>8</b> Measuring Performance</a><ul>
<li class="chapter" data-level="8.1" data-path="regression-model-performance.html"><a href="regression-model-performance.html"><i class="fa fa-check"></i><b>8.1</b> Regression Model Performance</a></li>
<li class="chapter" data-level="8.2" data-path="classification-model-performance.html"><a href="classification-model-performance.html"><i class="fa fa-check"></i><b>8.2</b> Classification Model Performance</a><ul>
<li class="chapter" data-level="8.2.1" data-path="classification-model-performance.html"><a href="classification-model-performance.html#confusion-matrix"><i class="fa fa-check"></i><b>8.2.1</b> Confusion Matrix</a></li>
<li class="chapter" data-level="8.2.2" data-path="classification-model-performance.html"><a href="classification-model-performance.html#kappa-statistic"><i class="fa fa-check"></i><b>8.2.2</b> Kappa Statistic</a></li>
<li class="chapter" data-level="8.2.3" data-path="classification-model-performance.html"><a href="classification-model-performance.html#roc"><i class="fa fa-check"></i><b>8.2.3</b> ROC</a></li>
<li class="chapter" data-level="8.2.4" data-path="classification-model-performance.html"><a href="classification-model-performance.html#gain-and-lift-charts"><i class="fa fa-check"></i><b>8.2.4</b> Gain and Lift Charts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression-models.html"><a href="regression-models.html"><i class="fa fa-check"></i><b>9</b> Regression Models</a><ul>
<li class="chapter" data-level="9.1" data-path="ordinary-least-squares.html"><a href="ordinary-least-squares.html"><i class="fa fa-check"></i><b>9.1</b> Ordinary Least Squares</a></li>
<li class="chapter" data-level="9.2" data-path="multivariate-adaptive-regression-splines.html"><a href="multivariate-adaptive-regression-splines.html"><i class="fa fa-check"></i><b>9.2</b> Multivariate Adaptive Regression Splines</a></li>
<li class="chapter" data-level="9.3" data-path="generalized-linear-model.html"><a href="generalized-linear-model.html"><i class="fa fa-check"></i><b>9.3</b> Generalized Linear Model</a></li>
<li class="chapter" data-level="9.4" data-path="pcr-and-pls.html"><a href="pcr-and-pls.html"><i class="fa fa-check"></i><b>9.4</b> PCR and PLS</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="regularization-methods.html"><a href="regularization-methods.html"><i class="fa fa-check"></i><b>10</b> Regularization Methods</a><ul>
<li class="chapter" data-level="10.1" data-path="ridge-regression.html"><a href="ridge-regression.html"><i class="fa fa-check"></i><b>10.1</b> Ridge Regression</a></li>
<li class="chapter" data-level="10.2" data-path="lasso.html"><a href="lasso.html"><i class="fa fa-check"></i><b>10.2</b> LASSO</a></li>
<li class="chapter" data-level="10.3" data-path="variable-selection-property-of-the-lasso.html"><a href="variable-selection-property-of-the-lasso.html"><i class="fa fa-check"></i><b>10.3</b> Variable selection property of the lasso</a></li>
<li class="chapter" data-level="10.4" data-path="elastic-net.html"><a href="elastic-net.html"><i class="fa fa-check"></i><b>10.4</b> Elastic Net</a></li>
<li class="chapter" data-level="10.5" data-path="penalized-generalized-linear-model.html"><a href="penalized-generalized-linear-model.html"><i class="fa fa-check"></i><b>10.5</b> Penalized Generalized Linear Model</a><ul>
<li class="chapter" data-level="10.5.1" data-path="penalized-generalized-linear-model.html"><a href="penalized-generalized-linear-model.html#introduction-to-glmnet-package"><i class="fa fa-check"></i><b>10.5.1</b> Introduction to <code>glmnet</code> package</a></li>
<li class="chapter" data-level="10.5.2" data-path="penalized-generalized-linear-model.html"><a href="penalized-generalized-linear-model.html#penalized-logistic-regression"><i class="fa fa-check"></i><b>10.5.2</b> Penalized logistic regression</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="treemodel.html"><a href="treemodel.html"><i class="fa fa-check"></i><b>11</b> Tree-Based Methods</a><ul>
<li class="chapter" data-level="11.1" data-path="splitting-criteria.html"><a href="splitting-criteria.html"><i class="fa fa-check"></i><b>11.1</b> Splitting Criteria</a></li>
<li class="chapter" data-level="11.2" data-path="tree-pruning.html"><a href="tree-pruning.html"><i class="fa fa-check"></i><b>11.2</b> Tree Pruning</a></li>
<li class="chapter" data-level="11.3" data-path="regression-and-decision-tree-basic.html"><a href="regression-and-decision-tree-basic.html"><i class="fa fa-check"></i><b>11.3</b> Regression and Decision Tree Basic</a><ul>
<li class="chapter" data-level="11.3.1" data-path="regression-and-decision-tree-basic.html"><a href="regression-and-decision-tree-basic.html#regression-tree"><i class="fa fa-check"></i><b>11.3.1</b> Regression Tree</a></li>
<li class="chapter" data-level="11.3.2" data-path="regression-and-decision-tree-basic.html"><a href="regression-and-decision-tree-basic.html#decision-tree"><i class="fa fa-check"></i><b>11.3.2</b> Decision Tree</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="bagging-tree-1.html"><a href="bagging-tree-1.html"><i class="fa fa-check"></i><b>11.4</b> Bagging Tree</a></li>
<li class="chapter" data-level="11.5" data-path="random-forest.html"><a href="random-forest.html"><i class="fa fa-check"></i><b>11.5</b> Random Forest</a></li>
<li class="chapter" data-level="11.6" data-path="gradient-boosted-machine.html"><a href="gradient-boosted-machine.html"><i class="fa fa-check"></i><b>11.6</b> Gradient Boosted Machine</a><ul>
<li class="chapter" data-level="11.6.1" data-path="gradient-boosted-machine.html"><a href="gradient-boosted-machine.html#adaptive-boosting"><i class="fa fa-check"></i><b>11.6.1</b> Adaptive Boosting</a></li>
<li class="chapter" data-level="11.6.2" data-path="gradient-boosted-machine.html"><a href="gradient-boosted-machine.html#stochastic-gradient-boosting"><i class="fa fa-check"></i><b>11.6.2</b> Stochastic Gradient Boosting</a></li>
<li class="chapter" data-level="11.6.3" data-path="gradient-boosted-machine.html"><a href="gradient-boosted-machine.html#boosting-as-additive-model"><i class="fa fa-check"></i><b>11.6.3</b> Boosting as Additive Model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="deep-learning.html"><a href="deep-learning.html"><i class="fa fa-check"></i><b>12</b> Deep Learning</a><ul>
<li class="chapter" data-level="12.1" data-path="deep-learning-introduction-and-history.html"><a href="deep-learning-introduction-and-history.html"><i class="fa fa-check"></i><b>12.1</b> Deep Learning Introduction and History</a></li>
<li class="chapter" data-level="12.2" data-path="projection-pursuit-regression.html"><a href="projection-pursuit-regression.html"><i class="fa fa-check"></i><b>12.2</b> Projection Pursuit Regression</a></li>
<li class="chapter" data-level="12.3" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html"><i class="fa fa-check"></i><b>12.3</b> Feedforward Neural Network</a><ul>
<li class="chapter" data-level="12.3.1" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html#logistic_reg_as_neural_network"><i class="fa fa-check"></i><b>12.3.1</b> Logistic Regression as Neural Network</a></li>
<li class="chapter" data-level="12.3.2" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html#gradient-descent"><i class="fa fa-check"></i><b>12.3.2</b> Gradient Descent</a></li>
<li class="chapter" data-level="12.3.3" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html#deep-neural-network"><i class="fa fa-check"></i><b>12.3.3</b> Deep Neural Network</a></li>
<li class="chapter" data-level="12.3.4" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html#activation-function"><i class="fa fa-check"></i><b>12.3.4</b> Activation Function</a></li>
<li class="chapter" data-level="12.3.5" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html#deal-with-overfitting"><i class="fa fa-check"></i><b>12.3.5</b> Deal with Overfitting</a></li>
<li class="chapter" data-level="12.3.6" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html#optimization"><i class="fa fa-check"></i><b>12.3.6</b> Optimization</a></li>
<li class="chapter" data-level="12.3.7" data-path="feedforward-neural-network.html"><a href="feedforward-neural-network.html#image-recognition-using-ffnn"><i class="fa fa-check"></i><b>12.3.7</b> Image Recognition Using FFNN</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="convolutional-neural-network.html"><a href="convolutional-neural-network.html"><i class="fa fa-check"></i><b>12.4</b> Convolutional Neural Network</a><ul>
<li class="chapter" data-level="12.4.1" data-path="convolutional-neural-network.html"><a href="convolutional-neural-network.html#convolution-layer"><i class="fa fa-check"></i><b>12.4.1</b> Convolution Layer</a></li>
<li class="chapter" data-level="12.4.2" data-path="convolutional-neural-network.html"><a href="convolutional-neural-network.html#padding-layer"><i class="fa fa-check"></i><b>12.4.2</b> Padding Layer</a></li>
<li class="chapter" data-level="12.4.3" data-path="convolutional-neural-network.html"><a href="convolutional-neural-network.html#pooling-layer"><i class="fa fa-check"></i><b>12.4.3</b> Pooling Layer</a></li>
<li class="chapter" data-level="12.4.4" data-path="convolutional-neural-network.html"><a href="convolutional-neural-network.html#convolution-over-volume"><i class="fa fa-check"></i><b>12.4.4</b> Convolution Over Volume</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="recurrent-neural-network.html"><a href="recurrent-neural-network.html"><i class="fa fa-check"></i><b>12.5</b> Recurrent Neural Network</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="r-code-for-data-simulation.html"><a href="r-code-for-data-simulation.html"><i class="fa fa-check"></i><b>A</b> R code for data simulation</a><ul>
<li class="chapter" data-level="A.1" data-path="customer-data-for-clothing-company.html"><a href="customer-data-for-clothing-company.html"><i class="fa fa-check"></i><b>A.1</b> Customer Data for Clothing Company</a></li>
<li class="chapter" data-level="A.2" data-path="customer-satisfaction-survey-data-from-airline-company-1.html"><a href="customer-satisfaction-survey-data-from-airline-company-1.html"><i class="fa fa-check"></i><b>A.2</b> Customer Satisfaction Survey Data from Airline Company</a></li>
<li class="chapter" data-level="A.3" data-path="swine-disease-breakout-data.html"><a href="swine-disease-breakout-data.html"><i class="fa fa-check"></i><b>A.3</b> Swine Disease Breakout Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="convolutional-neural-network" class="section level2">
<h2><span class="header-section-number">12.4</span> Convolutional Neural Network</h2>
<p>There are some challenges using a feedforward neural network to solve computer vision problems. One of the challenges is that the inputs can get really big after you vectorize the image array. A 64 x 64 x 3 image gives you an input vector of 12288! And that is a very small image. So you can expect the number of parameters grows fast and it is difficult to get enough data to fit the model. Also as the input image size grows, the computational requirements to train a feedforward neural network will soon become infeasible. Also, after vectorization, you lose most of the spacial information of the image. To overcome these, people instead use the convolutional neural network for computer vision problems.</p>
<p>This section introduces the Convolutional Neural Network (CNN), the deep learning model that is almost universally used in computer vision applications. Computer vision has been advancing rapidly which enables many new applications such as self-driving cars and unlocking a phone using face. The application is not limited to the tech industry but some traditional industries such as agriculture and healthcare. Precision agriculture utilizes advanced hardware and computer vision algorithms to increase efficiency and reduce costs for farmers. For example, analyze images from cameras in the greenhouse to track plant growth state. Use sensory data from drones, satellites, and tractors to track soil conditions, detect herbs and pests, automate irrigation, etc. In health care, computer vision helps clinicians to diagnose disease, identify cancer sites with high accuracy <span class="citation">(Kwak and Hui <a href="#ref-gloria2019">2019</a>)</span>. Even if you don’t work on computer vision, you may find some of the ideas inspiring and borrow them into your area.</p>
<p>Some popular computer vision problems are:</p>
<ul>
<li>Image classification (or image recognition): Recognize the object in the image. Is there a cat in the image? Who is this person?</li>
<li>Object detection: Detect the position and boarder of a specific object. For example, if you are building a self-driving car, you need to know the positions of other cars around you.</li>
<li>Neural Style Transfer (NST): Given a “content” image and a “style” image, generate an image that merges the two.</li>
</ul>
<div id="convolution-layer" class="section level3">
<h3><span class="header-section-number">12.4.1</span> Convolution Layer</h3>
<p>A fundamental building block of the convolution neural network is, as the name indicates, the convolution operation. In this chapter, we illustrate the fundamentals of CNN using the example of image classification.</p>
<p>How do you do convolution? For example, you have a 5 x 5 2-d image (figure <a href="convolutional-neural-network.html#fig:convolution1">11.9</a>. You apply a 3 x 3 filter and convolute over the image. The output of this convolution operator will be a 3 x 3 matrix, which you can consider as a 3 x 3 image and visualize it (top right of figure <a href="convolutional-neural-network.html#fig:convolution1">11.9</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:convolution1"></span>
<img src="images/convolution1.png" alt="There are an input image (left), a filter (middel), and an output image (right)." width="80%" />
<p class="caption">
FIGURE 11.9: There are an input image (left), a filter (middel), and an output image (right).
</p>
</div>
<p>You start from the top left corner of the image and put the filter on the top left 3 x3 sub-matrix of the input image and take the element-wise product. Then you add up the 9 numbers. Move forward one step each time until it gets to the bottom right. The detailed process is shown in figure <a href="convolutional-neural-network.html#fig:convolutionsbs">11.10</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:convolutionsbs"></span>
<img src="images/convolutionsbs.png" alt="Convolution step by step" width="80%" />
<p class="caption">
FIGURE 11.10: Convolution step by step
</p>
</div>
<p>Let’s use edge detection as an example to see how convolution operation works. Given a picture as the left of figure <a href="convolutional-neural-network.html#fig:edgedetection">11.11</a>, you want to detect the vertical lines. For example, there are vertical lines along with the hair and the edges of the bookcase. How do you do that? There are standard filters for operations like blurring, sharpening, and edge detection. To get the edge, you can use the following 3 x 3 filter to convolute over the image.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" data-line-number="1">kernel_vertical =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, <span class="dv">-1</span>),</a>
<a class="sourceLine" id="cb414-2" data-line-number="2"><span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb414-3" data-line-number="3"></a>
<a class="sourceLine" id="cb414-4" data-line-number="4">kernel_vertical</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    0   -1
## [2,]    1    0   -1
## [3,]    1    0   -1</code></pre>
<p>The following code implements the convolution process. The result is shown as the middle of figure <a href="convolutional-neural-network.html#fig:edgedetection">11.11</a>.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" data-line-number="1">image =<span class="st"> </span>magick<span class="op">::</span><span class="kw">image_read</span>(<span class="st">&quot;http://bit.ly/2Nh5ANX&quot;</span>)</a>
<a class="sourceLine" id="cb416-2" data-line-number="2">kernel_vertical =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, <span class="dv">-1</span>), </a>
<a class="sourceLine" id="cb416-3" data-line-number="3">                       <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb416-4" data-line-number="4"></a>
<a class="sourceLine" id="cb416-5" data-line-number="5">kernel_horizontal =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">-1</span>, <span class="dv">-1</span>, <span class="dv">-1</span>), </a>
<a class="sourceLine" id="cb416-6" data-line-number="6">                       <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> T)</a>
<a class="sourceLine" id="cb416-7" data-line-number="7"></a>
<a class="sourceLine" id="cb416-8" data-line-number="8">image_edge_vertical =<span class="st"> </span>magick<span class="op">::</span><span class="kw">image_convolve</span>(image, kernel_vertical)</a>
<a class="sourceLine" id="cb416-9" data-line-number="9">image_edge_horizontal =<span class="st"> </span>magick<span class="op">::</span><span class="kw">image_convolve</span>(image, kernel_horizontal)</a>
<a class="sourceLine" id="cb416-10" data-line-number="10"></a>
<a class="sourceLine" id="cb416-11" data-line-number="11"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb416-12" data-line-number="12"></a>
<a class="sourceLine" id="cb416-13" data-line-number="13"><span class="kw">plot</span>(image)</a>
<a class="sourceLine" id="cb416-14" data-line-number="14"><span class="kw">plot</span>(image_edge_vertical)</a>
<a class="sourceLine" id="cb416-15" data-line-number="15"><span class="kw">plot</span>(image_edge_horizontal)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:edgedetection"></span>
<img src="images/edgedet5.png" alt="Edge Detection Example" width="100%" />
<p class="caption">
FIGURE 11.11: Edge Detection Example
</p>
</div>
<p>Why can <code>kernel_vertical</code> detect vertical edge? Let’s look at a simpler example. The following 8 x 8 matrix where half of the matrix is 10 and the other half is 0. The corresponding image is shown as the left of the figure <a href="convolutional-neural-network.html#fig:simpleedge">11.12</a>.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1">input_image =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dv">8</span>), </a>
<a class="sourceLine" id="cb417-2" data-line-number="2">                     <span class="dt">nrow =</span> <span class="dv">8</span>, <span class="dt">byrow =</span> T)</a>
<a class="sourceLine" id="cb417-3" data-line-number="3">input_image</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
## [1,]  200  200  200  200    0    0    0    0
## [2,]  200  200  200  200    0    0    0    0
## [3,]  200  200  200  200    0    0    0    0
## [4,]  200  200  200  200    0    0    0    0
## [5,]  200  200  200  200    0    0    0    0
## [6,]  200  200  200  200    0    0    0    0
## [7,]  200  200  200  200    0    0    0    0
## [8,]  200  200  200  200    0    0    0    0</code></pre>
<p>If we use the above filter kernel_vertical , the output matrix is shown below and the corresponding image is shown as the right of the figure <a href="convolutional-neural-network.html#fig:simpleedge">11.12</a>.</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1">output_image =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dv">6</span>), </a>
<a class="sourceLine" id="cb419-2" data-line-number="2">                      <span class="dt">nrow =</span> <span class="dv">6</span>, <span class="dt">byrow =</span> T)</a>
<a class="sourceLine" id="cb419-3" data-line-number="3">output_image</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    0    0  200  200    0    0
## [2,]    0    0  200  200    0    0
## [3,]    0    0  200  200    0    0
## [4,]    0    0  200  200    0    0
## [5,]    0    0  200  200    0    0
## [6,]    0    0  200  200    0    0</code></pre>
<div class="figure" style="text-align: center"><span id="fig:simpleedge"></span>
<img src="IDS_files/figure-html/simpleedge-1.svg" alt="Simple Edge Detection Example" width="80%" />
<p class="caption">
FIGURE 11.12: Simple Edge Detection Example
</p>
</div>
<p>So the output image has a lighter region in the middle that corresponds to the vertical edge of the input image. When the input image is large, such as the image in figure <a href="convolutional-neural-network.html#fig:edgedetection">11.11</a> is 1020 x 711, the edge will not seem as thick as it is in this small example. To detect the horizontal edge, you only need to rotate the filter by 90 degrees. The right image in figure <a href="convolutional-neural-network.html#fig:edgedetection">11.11</a> shows the horizontal edge detection result. You can see how convolution operator detects a specific feature from the image.</p>
<p>The parameters for the convolution operation are the elements in the filter. For a 3x3 filter shown below, the parameters to estimate are <span class="math inline">\(w_1\)</span> to <span class="math inline">\(w_9\)</span>. So far, we move the filter one step each time when we convolve. You can do more than 1 step as well. For example, you can hop 2 steps each time after the sum of the element-wise product. It is called strided-convolution. Use stride <span class="math inline">\(s\)</span> means the output is downsized by a factor of <span class="math inline">\(s\)</span>. It is rarely used in practice but it is good to be familiar with the concept.</p>
<div class="figure" style="text-align: center"><span id="fig:convolutionlayer"></span>
<img src="images/convlayer.png" alt="Convolution Layer Parameters" width="100%" />
<p class="caption">
FIGURE 11.13: Convolution Layer Parameters
</p>
</div>
</div>
<div id="padding-layer" class="section level3">
<h3><span class="header-section-number">12.4.2</span> Padding Layer</h3>
<p>Assume the stride is <span class="math inline">\(s\)</span> and we have a <span class="math inline">\(n \times n\)</span> input image to convolve with a <span class="math inline">\(f \times f\)</span> filter, the output image is <span class="math inline">\((\frac{n-f}{s} + 1) \times (\frac{n-f}{s} + 1)\)</span>. After each convolution, the dimension of the output shrinks. Depending on the size of the input image, the output size may get too small after a few rounds. Also, the pixel at the corner is used less than the pixel in the middle. So it overlooks some information in the image. To overcome these problems, you can add a padding layer during the process. To keep the output the same size as the input image in figure <a href="convolutional-neural-network.html#fig:convolutionlayer">11.13</a>, you can pad two pixels on each side of the image with 0 (figure <a href="convolutional-neural-network.html#fig:padding">11.14</a> ).</p>
<div class="figure" style="text-align: center"><span id="fig:padding"></span>
<img src="images/padding.png" alt="Padding Layer" width="100%" />
<p class="caption">
FIGURE 11.14: Padding Layer
</p>
</div>
<p>If the stride is <span class="math inline">\(s\)</span> and we have a <span class="math inline">\(n \times n\)</span> input image to convolve with a <span class="math inline">\(f \times f\)</span> filter. This time we pad <span class="math inline">\(p\)</span> pixels in each side, then the output size becomes <span class="math inline">\((\frac{n + 2p -f}{s} + 1) \times (\frac{n + 2p -f}{s} + 1)\)</span>. You can specify the value for p and also the pixel value used. Or you can just use 0 to pad and make the output the same size with input.</p>
</div>
<div id="pooling-layer" class="section level3">
<h3><span class="header-section-number">12.4.3</span> Pooling Layer</h3>
<p>People sometimes use the pooling layer to reduce the size of the representation and make some of the feature detection more robust. If you have a <span class="math inline">\(4 \times 4\)</span> input, the max and mean pooling operation are shown in the figure <a href="convolutional-neural-network.html#fig:poolinglayer">11.15</a>. The process is quite simple. In the example, the filter is <span class="math inline">\(2 \times 2\)</span> and stride is 2, so break the input into four <span class="math inline">\(2 \times 2\)</span> regions (shown in the figure with different shaded colors). For max pooling, each of the outputs is the maximum from the corresponding shaded sub-region. Mean pooling layer works in the same way except for getting the mean instead of maximum of the sub-region. The pooling layer has hyperparameters (<span class="math inline">\(f\)</span> and <span class="math inline">\(s\)</span>) but it has no parameter for gradient descent to learn.</p>
<div class="figure" style="text-align: center"><span id="fig:poolinglayer"></span>
<img src="images/poolinglayer.png" alt="Pooling Layer" width="100%" />
<p class="caption">
FIGURE 11.15: Pooling Layer
</p>
</div>
<p>Let’s go through an example of pooling a 2D grayscale image. Hope it gives you some intuition behind what it does. Read the image and convert the original color image (a 3D array) to grayscale (a 2D matrix).</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" data-line-number="1"><span class="kw">library</span>(EBImage)</a>
<a class="sourceLine" id="cb421-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb421-3" data-line-number="3"></a>
<a class="sourceLine" id="cb421-4" data-line-number="4">eggshell &lt;-<span class="st"> </span><span class="kw">readImage</span>(<span class="st">&quot;https://scientistcafe.com/images/eggshell.jpeg&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb421-5" data-line-number="5"><span class="st">  </span><span class="co"># make it smaller</span></a>
<a class="sourceLine" id="cb421-6" data-line-number="6"><span class="st">  </span><span class="kw">resize</span>(<span class="dv">560</span>, <span class="dv">420</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb421-7" data-line-number="7"><span class="st">  </span><span class="co"># rotate image</span></a>
<a class="sourceLine" id="cb421-8" data-line-number="8"><span class="st">  </span><span class="kw">rotate</span>(<span class="dv">90</span>)</a>
<a class="sourceLine" id="cb421-9" data-line-number="9"></a>
<a class="sourceLine" id="cb421-10" data-line-number="10"><span class="co"># convert to 2D grayscale</span></a>
<a class="sourceLine" id="cb421-11" data-line-number="11">gray_eggshell =<span class="st"> </span><span class="kw">apply</span>(eggshell, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), mean)</a></code></pre></div>
<p>The following function takes an image matrix or array, and apply pooling operation.</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1">pooling &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">type =</span> <span class="st">&quot;max&quot;</span>, image, filter, stride) {</a>
<a class="sourceLine" id="cb422-2" data-line-number="2">    f &lt;-<span class="st"> </span>filter</a>
<a class="sourceLine" id="cb422-3" data-line-number="3">    s &lt;-<span class="st"> </span>stride</a>
<a class="sourceLine" id="cb422-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb422-5" data-line-number="5">    <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">dim</span>(image)) <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) {</a>
<a class="sourceLine" id="cb422-6" data-line-number="6">        <span class="co"># get image dimensions</span></a>
<a class="sourceLine" id="cb422-7" data-line-number="7">        col &lt;-<span class="st"> </span><span class="kw">dim</span>(image[, , <span class="dv">1</span>])[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb422-8" data-line-number="8">        row &lt;-<span class="st"> </span><span class="kw">dim</span>(image[, , <span class="dv">1</span>])[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb422-9" data-line-number="9">        <span class="co"># calculate new dimension size</span></a>
<a class="sourceLine" id="cb422-10" data-line-number="10">        c &lt;-<span class="st"> </span>(col <span class="op">-</span><span class="st"> </span>f)<span class="op">/</span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-11" data-line-number="11">        r &lt;-<span class="st"> </span>(row <span class="op">-</span><span class="st"> </span>f)<span class="op">/</span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-12" data-line-number="12">        <span class="co"># create new image object</span></a>
<a class="sourceLine" id="cb422-13" data-line-number="13">        newImage &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="kw">c</span>(c, r, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb422-14" data-line-number="14">        <span class="co"># loops in RGB layers</span></a>
<a class="sourceLine" id="cb422-15" data-line-number="15">        <span class="cf">for</span> (rgb <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) {</a>
<a class="sourceLine" id="cb422-16" data-line-number="16">            m &lt;-<span class="st"> </span>image[, , rgb]</a>
<a class="sourceLine" id="cb422-17" data-line-number="17">            m3 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">ncol =</span> c, <span class="dt">nrow =</span> r)</a>
<a class="sourceLine" id="cb422-18" data-line-number="18">            i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-19" data-line-number="19">            <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;mean&quot;</span>) </a>
<a class="sourceLine" id="cb422-20" data-line-number="20">                <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>r) {</a>
<a class="sourceLine" id="cb422-21" data-line-number="21">                  j &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-22" data-line-number="22">                  <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>c) {</a>
<a class="sourceLine" id="cb422-23" data-line-number="23">                    m3[ii, jj] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">as.numeric</span>(m[i<span class="op">:</span>(i <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-24" data-line-number="24"><span class="st">                      </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)), j<span class="op">:</span>(j <span class="op">+</span><span class="st"> </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))]))</a>
<a class="sourceLine" id="cb422-25" data-line-number="25">                    j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-26" data-line-number="26">                  }</a>
<a class="sourceLine" id="cb422-27" data-line-number="27">                  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-28" data-line-number="28">                } <span class="cf">else</span> <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>r) {</a>
<a class="sourceLine" id="cb422-29" data-line-number="29">                j =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-30" data-line-number="30">                <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>c) {</a>
<a class="sourceLine" id="cb422-31" data-line-number="31">                  m3[ii, jj] &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">as.numeric</span>(m[i<span class="op">:</span>(i <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-32" data-line-number="32"><span class="st">                    </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)), j<span class="op">:</span>(j <span class="op">+</span><span class="st"> </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))]))</a>
<a class="sourceLine" id="cb422-33" data-line-number="33">                  j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-34" data-line-number="34">                }</a>
<a class="sourceLine" id="cb422-35" data-line-number="35">                i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-36" data-line-number="36">            }</a>
<a class="sourceLine" id="cb422-37" data-line-number="37">            newImage[, , rgb] &lt;-<span class="st"> </span>m3</a>
<a class="sourceLine" id="cb422-38" data-line-number="38">        }</a>
<a class="sourceLine" id="cb422-39" data-line-number="39">    } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">dim</span>(image)) <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb422-40" data-line-number="40">        <span class="co"># get image dimensions</span></a>
<a class="sourceLine" id="cb422-41" data-line-number="41">        col &lt;-<span class="st"> </span><span class="kw">dim</span>(image)[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb422-42" data-line-number="42">        row &lt;-<span class="st"> </span><span class="kw">dim</span>(image)[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb422-43" data-line-number="43">        <span class="co"># calculate new dimension size</span></a>
<a class="sourceLine" id="cb422-44" data-line-number="44">        c &lt;-<span class="st"> </span>(col <span class="op">-</span><span class="st"> </span>f)<span class="op">/</span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-45" data-line-number="45">        r &lt;-<span class="st"> </span>(row <span class="op">-</span><span class="st"> </span>f)<span class="op">/</span>s <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-46" data-line-number="46">        m3 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">ncol =</span> c, <span class="dt">nrow =</span> r)</a>
<a class="sourceLine" id="cb422-47" data-line-number="47">        i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-48" data-line-number="48">        <span class="cf">if</span> (type <span class="op">==</span><span class="st"> &quot;mean&quot;</span>) </a>
<a class="sourceLine" id="cb422-49" data-line-number="49">            <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>r) {</a>
<a class="sourceLine" id="cb422-50" data-line-number="50">                j &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-51" data-line-number="51">                <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>c) {</a>
<a class="sourceLine" id="cb422-52" data-line-number="52">                  m3[ii, jj] &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">as.numeric</span>(image[i<span class="op">:</span>(i <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-53" data-line-number="53"><span class="st">                    </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)), j<span class="op">:</span>(j <span class="op">+</span><span class="st"> </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))]))</a>
<a class="sourceLine" id="cb422-54" data-line-number="54">                  j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-55" data-line-number="55">                }</a>
<a class="sourceLine" id="cb422-56" data-line-number="56">                i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-57" data-line-number="57">            } <span class="cf">else</span> <span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>r) {</a>
<a class="sourceLine" id="cb422-58" data-line-number="58">            j =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb422-59" data-line-number="59">            <span class="cf">for</span> (jj <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>c) {</a>
<a class="sourceLine" id="cb422-60" data-line-number="60">                m3[ii, jj] &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">as.numeric</span>(image[i<span class="op">:</span>(i <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb422-61" data-line-number="61"><span class="st">                  </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)), j<span class="op">:</span>(j <span class="op">+</span><span class="st"> </span>(f <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))]))</a>
<a class="sourceLine" id="cb422-62" data-line-number="62">                j &lt;-<span class="st"> </span>j <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-63" data-line-number="63">            }</a>
<a class="sourceLine" id="cb422-64" data-line-number="64">            i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span>s</a>
<a class="sourceLine" id="cb422-65" data-line-number="65">        }</a>
<a class="sourceLine" id="cb422-66" data-line-number="66">        newImage &lt;-<span class="st"> </span>m3</a>
<a class="sourceLine" id="cb422-67" data-line-number="67">    }</a>
<a class="sourceLine" id="cb422-68" data-line-number="68">    <span class="kw">return</span>(newImage)</a>
<a class="sourceLine" id="cb422-69" data-line-number="69">}</a></code></pre></div>
<p>Let’s apply both max and mean pooling with filter size 10 (<span class="math inline">\(f = 10\)</span>) and stride 10 (<span class="math inline">\(s = 10\)</span>).</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" data-line-number="1">gray_eggshell_max =<span class="st"> </span><span class="kw">pooling</span>(<span class="dt">type =</span> <span class="st">&quot;max&quot;</span>,</a>
<a class="sourceLine" id="cb423-2" data-line-number="2">                            <span class="dt">image =</span> gray_eggshell,</a>
<a class="sourceLine" id="cb423-3" data-line-number="3">                            <span class="dt">filter =</span> <span class="dv">10</span>, <span class="dt">stride =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb423-4" data-line-number="4"></a>
<a class="sourceLine" id="cb423-5" data-line-number="5">gray_eggshell_mean =<span class="st"> </span><span class="kw">pooling</span>(<span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>,</a>
<a class="sourceLine" id="cb423-6" data-line-number="6">                             <span class="dt">image =</span> gray_eggshell,</a>
<a class="sourceLine" id="cb423-7" data-line-number="7">                             <span class="dt">filter =</span> <span class="dv">10</span>, <span class="dt">stride =</span> <span class="dv">10</span>)</a></code></pre></div>
<p>You can see the result by plotting the output image (figure <a href="convolutional-neural-network.html#fig:eggshellconv">11.16</a>). The top left is the original color picture. The top right is the 2D grayscale picture. The bottom left is the result of max pooling. The bottom right is the result of mean pooling. The max-pooling gives you the value of the largest pixel and the mean-pooling gives the average of the patch. You can consider it as a representation of features, looking at the maximal or average presence of different features. In general, max-pooling works better. You can gain some intuition from the example (figure <a href="convolutional-neural-network.html#fig:eggshellconv">11.16</a>). The max-pooling “picks” more distinct features and average-pooling blurs out features evenly.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb424-2" data-line-number="2"><span class="kw">plot</span>(eggshell)</a>
<a class="sourceLine" id="cb424-3" data-line-number="3"><span class="kw">plot</span>(<span class="kw">as.Image</span>(gray_eggshell))</a>
<a class="sourceLine" id="cb424-4" data-line-number="4"><span class="kw">plot</span>(<span class="kw">as.Image</span>(gray_eggshell_max))</a>
<a class="sourceLine" id="cb424-5" data-line-number="5"><span class="kw">plot</span>(<span class="kw">as.Image</span>(gray_eggshell_mean))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:eggshellconv"></span>
<img src="images/eggshellconv.png" alt="Example of max and mean pooling" width="70%" />
<p class="caption">
FIGURE 11.16: Example of max and mean pooling
</p>
</div>
</div>
<div id="convolution-over-volume" class="section level3">
<h3><span class="header-section-number">12.4.4</span> Convolution Over Volume</h3>
<p>So far, we have shown different types of layers on 2D inputs. If you have a 3D input (such as a color image), then the filters will have 3 channels too. For example, if you have a <span class="math inline">\(6 \times 6\)</span> color image, the input dimension is <span class="math inline">\(6 \times 6 \times 3\)</span>. We call them the height, width, and the number of channels. The filter itself has 3 channels corresponding to the red, green, and blue channels of the input. You can consider it as a 3D cube with 27 parameters. Apply each channel of the filter to the corresponding channel of the input. Multiply each of the 27 numbers with the corresponding numbers from the top left region of the color input image and add them up. Add a bias parameter and apply an activation function which gives you the first number of the output image. Then slide it over to calculate the next one. The final output is 2D <span class="math inline">\(4 \times 4\)</span>. If you want to detect features in the red channel only, you can use a filter with the second and third channels to be all 0s. With different choices of the parameters, you can get different feature detectors. You can use more than one filter and each filter has multiple channels. For example, you can use one <span class="math inline">\(3 \times 3 \times 3\)</span> filter to detect the horizontal edge and another to detect the vertical edge. Figure <a href="convolutional-neural-network.html#fig:eggshellconv">11.16</a> shows an example of one layer with two filters. Each filter has a dimension of <span class="math inline">\(3 \times 3 \times 3\)</span>. The output dimension is <span class="math inline">\(4 \times 4 \times 2\)</span>. The output has two channels because we have two filters on the layer. The total number of parameters is 58 (each filter has one bias parameter <span class="math inline">\(b\)</span>).</p>
<div class="figure" style="text-align: center"><span id="fig:ConvOverVolume"></span>
<img src="images/ConvOverVolume.png" alt="Example of convolution over volume" width="70%" />
<p class="caption">
FIGURE 11.17: Example of convolution over volume
</p>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-gloria2019">
<p>Kwak, Gloria Hyun Jung, and Pan Hui. 2019. “DeepHealth: Deep Learning for Health Informatics Reviews, Challenges, and Opportunities on Medical Imaging, Electronic Health Records, Genomics, Sensing, and Online Communication Health.” 2019.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="feedforward-neural-network.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="recurrent-neural-network.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/happyrabbit/IntroDataScience/12-DeepLearning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["IDS.pdf", "IDS.epub", "IDS.mobi"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
