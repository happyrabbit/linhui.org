<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>SQL for Data Science</title>
  <meta name="description" content="This is my notes on Unix">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="SQL for Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is my notes on Unix" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="SQL for Data Science" />
  
  <meta name="twitter:description" content="This is my notes on Unix" />
  

<meta name="author" content="Hui Lin">


<meta name="date" content="2018-01-26">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="subqueries-and-joins.html">
<link rel="next" href="joins.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Statement</a></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="what-is-sql.html"><a href="what-is-sql.html"><i class="fa fa-check"></i><b>1.1</b> What is SQL?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-models-and-diagrams.html"><a href="data-models-and-diagrams.html"><i class="fa fa-check"></i><b>2</b> Data Models and Diagrams</a><ul>
<li class="chapter" data-level="2.1" data-path="think-before-code.html"><a href="think-before-code.html"><i class="fa fa-check"></i><b>2.1</b> Think Before Code</a></li>
<li class="chapter" data-level="2.2" data-path="what-is-data-model.html"><a href="what-is-data-model.html"><i class="fa fa-check"></i><b>2.2</b> What is Data Model?</a></li>
<li class="chapter" data-level="2.3" data-path="retrive-data-with-select.html"><a href="retrive-data-with-select.html"><i class="fa fa-check"></i><b>2.3</b> Retrive Data with <code>SELECT</code></a></li>
<li class="chapter" data-level="2.4" data-path="create-table.html"><a href="create-table.html"><i class="fa fa-check"></i><b>2.4</b> Create Table</a></li>
<li class="chapter" data-level="2.5" data-path="sql-comments.html"><a href="sql-comments.html"><i class="fa fa-check"></i><b>2.5</b> SQL Comments</a></li>
<li class="chapter" data-level="2.6" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>2.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="filtering-sorting-and-calculating-data-with-sql.html"><a href="filtering-sorting-and-calculating-data-with-sql.html"><i class="fa fa-check"></i><b>3</b> Filtering, Sorting, and Calculating Data with SQL</a><ul>
<li class="chapter" data-level="3.1" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>3.1</b> Filter</a><ul>
<li class="chapter" data-level="3.1.1" data-path="filter.html"><a href="filter.html#where"><i class="fa fa-check"></i><b>3.1.1</b> <code>WHERE</code></a></li>
<li class="chapter" data-level="3.1.2" data-path="filter.html"><a href="filter.html#in-or-and-not"><i class="fa fa-check"></i><b>3.1.2</b> <code>IN</code>, <code>OR</code> and <code>NOT</code></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="sort.html"><a href="sort.html"><i class="fa fa-check"></i><b>3.2</b> Sort</a></li>
<li class="chapter" data-level="3.3" data-path="math-operations.html"><a href="math-operations.html"><i class="fa fa-check"></i><b>3.3</b> Math Operations</a></li>
<li class="chapter" data-level="3.4" data-path="aggregrate-functions.html"><a href="aggregrate-functions.html"><i class="fa fa-check"></i><b>3.4</b> Aggregrate Functions</a></li>
<li class="chapter" data-level="3.5" data-path="group-data.html"><a href="group-data.html"><i class="fa fa-check"></i><b>3.5</b> Group Data</a></li>
<li class="chapter" data-level="3.6" data-path="summary-1.html"><a href="summary-1.html"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subqueries-and-joins.html"><a href="subqueries-and-joins.html"><i class="fa fa-check"></i><b>4</b> Subqueries and Joins</a><ul>
<li class="chapter" data-level="4.1" data-path="subqueries.html"><a href="subqueries.html"><i class="fa fa-check"></i><b>4.1</b> Subqueries</a></li>
<li class="chapter" data-level="4.2" data-path="joins.html"><a href="joins.html"><i class="fa fa-check"></i><b>4.2</b> Joins</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="modifying-and-analyzing-data-with-sql.html"><a href="modifying-and-analyzing-data-with-sql.html"><i class="fa fa-check"></i><b>5</b> Modifying and Analyzing Data with SQL</a><ul>
<li class="chapter" data-level="5.1" data-path="text-strings.html"><a href="text-strings.html"><i class="fa fa-check"></i><b>5.1</b> Text Strings</a></li>
<li class="chapter" data-level="5.2" data-path="date-and-time-strings.html"><a href="date-and-time-strings.html"><i class="fa fa-check"></i><b>5.2</b> Date and Time Strings</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SQL for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="subqueries" class="section level2">
<h2><span class="header-section-number">4.1</span> Subqueries</h2>
<ul>
<li>Define subqueries</li>
<li>Discuss advantages and disadvantages of using subqueries</li>
<li>Explain how subqueries help us merge data from two or more tables</li>
<li>Write more efficient subqueries</li>
</ul>
<p>Subqueries are queries embedded into other queries. Since data is stored in multiple tables, you may need to get information from multiple sources. Data scientists often use subqueries to:</p>
<ul>
<li>Select specific records or columns and then use the criteria as filtering criteria for the next thing they want to select.</li>
<li>Add additional criteria like filtering criteria that are not in your current table from another table into your query.</li>
</ul>
<p>Example: Need to know the region each customer is from who has had an order with freight over 100. The freight information is in table <code>Orders</code> and the customer information is in table <code>Customers</code>.</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> customerID, CompanyName, Region
<span class="kw">FROM</span> Customers
<span class="kw">WHERE</span> customerID <span class="kw">in</span> (<span class="kw">SELECT</span> customerID <span class="kw">FROM</span> Orders <span class="kw">WHERE</span> Freight &gt; <span class="dv">100</span>);</code></pre></div>
<p>DBMS is performing two operations:</p>
<ol style="list-style-type: decimal">
<li>Get the customer ID for the orders selected</li>
<li>Pass that to the <code>WHERE</code> clause and processing the overall <code>SELECT</code> statement</li>
</ol>
<p><strong>Note that it always perform the innermost <code>SELECT</code> portion first. </strong></p>
<ul>
<li><strong>Best Practices and Considerations</strong>
<ul>
<li>There is no limit to the number of subqueries you can have</li>
<li>Performance slows when you nest too deeply.</li>
<li>Subquery selects can only retrieve a single column</li>
</ul></li>
</ul>
<p>Also, when you use subqueries, the code gets harder to understand. One of the best practices for writing subqueries is to be clear and consistent with indenting to make it easier to read. This website will pre-format SQL code for you: www.poorsql.com</p>
<p>Subqueries can also be used as calculations.</p>
<p>Example: Get the total number of orders by each customer</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> customer_name,
    customer_state (<span class="kw">SELECT</span> <span class="fu">COUNT</span>(*) <span class="kw">AS</span> orders <span class="kw">FROM</span> Orders <span class="kw">WHERE</span> 
        Orders.customer_id = Customer.customer_id) <span class="kw">AS</span> orders
<span class="kw">FROM</span> customers
<span class="kw">ORDER</span> <span class="kw">BY</span> Customer_name</code></pre></div>
<p>As you can see, we’re selecting customer name, the region and then just as if we were going to select a different column name we have a whole subquery in there. We have <code>(SELECT COUNT(*) AS orders FROM Orders</code>, and count these based on the customer IDs. It’s aggregating the orders based on the customer IDs ( <code>Orders.customer_id = Customer.customer_id</code>). In the end, we order the table by customer name.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="subqueries-and-joins.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="joins.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": ["SQL.pdf", "SQL.epub", "SQL.mobi"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
